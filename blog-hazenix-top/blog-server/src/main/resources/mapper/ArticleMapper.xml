<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="top.hazenix.mapper.ArticleMapper">
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into article (title,content,cover_image,category_id,like_count,favorite_count,view_count,slug,status,create_time,update_time)
        values (#{title},#{content},#{coverImage},#{categoryId},#{likeCount},#{favoriteCount},#{viewCount},#{slug},#{status},#{createTime},#{updateTime})
    </insert>
    <update id="update">
        update article
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="content != null">
                content = #{content},
            </if>
            <if test="coverImage != null">
                cover_image = #{coverImage},
            </if>
            <if test="categoryId != null">
                category_id = #{categoryId},
            </if>
            <if test="likeCount != null">
                like_count = #{likeCount},
            </if>
            <if test="favoriteCount != null">
                favorite_count = #{favoriteCount},
            </if>
            <if test="viewCount != null">
                view_count = #{viewCount},
            </if>
            <if test="slug != null">
                slug = #{slug},
            </if>
            <if test="isTop != null">
                is_top = #{isTop},
            </if>
            <if test="status != null">
                status = #{status},
            </if>
            <if test="createTime != null">
                create_time = #{createTime},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
        </set>
        where id = #{id}
    </update>
    <delete id="deleteByIds">
        delete from article where id in
        <foreach item="id" collection="ids" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>


    <select id="count" resultType="java.lang.Integer">
        select count(*) from article
    </select>
    <select id="getRecentArticles" resultType="top.hazenix.vo.ArticleShortVO">
        select id,title,status,create_time from article order by update_time desc limit #{i}
    </select>
    <select id="pageQuery" resultType="top.hazenix.vo.ArticleShortVO">
        select id,title,status,create_time,is_top,like_count,favorite_count,view_count
        from article
        <where>
            <if test="keyword != null and keyword != ''">
                and title like concat('%',#{keyword},'%')
            </if>
            <if test="categoryId != null ">
                and category_id = #{categoryId}
            </if>
            <if test="status != null ">
                and status = #{status}
            </if>
        </where>
    </select>
    <select id="getById" resultType="top.hazenix.entity.Article">
        select * from article where id = #{id}
    </select>
    <select id="countByIds" resultType="java.lang.Integer">
        select count(id) from article where category_id in
                                          <foreach collection="ids" item="id" separator="," open="id in (" close=")">#{id}</foreach>
    </select>
</mapper>
