import{j as L,z as Z,r as m,k as ee,l as te,A as ae,c as r,o as n,B as se,J as v,I as le,b as s,a as i,t as u,w as d,d as g,F as I,n as U,M as A,_ as oe,u as ie,K as f,h as b,p as ne,e as z,g as re,$ as ce,a0 as ue,a1 as de,L as ve}from"./index-Cr_Or7lo.js";import{c as me,d as fe,i as _e,e as pe,l as he,f as ye}from"./article-CsEU7-wh.js";import{A as ge,M as ke,T as we,C as Ce}from"./TableOfContents-CTGzoSz2.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./helpers-DVd64Rx3.js";import"./avatar-Br5af8Id.js";const be={class:"article-detail"},Se={class:"article-container"},Te={class:"article-main"},xe={key:0,class:"article-content"},Ee={class:"article-header"},Le={class:"article-title"},De={key:0,class:"article-summary"},Re={class:"summary-content"},Me={key:1,class:"ai-summary"},Ne={class:"ai-summary-header"},Be={class:"ai-summary-title"},$e={class:"ai-summary-content"},Ie={class:"ai-summary-text"},Ue={class:"article-body"},ze={key:1,class:"empty-state"},je={class:"article-sidebar"},Fe={key:0,class:"sidebar-section"},Oe={key:1,class:"sidebar-section"},Pe={class:"related-articles"},Ve=["onClick"],Ye={class:"related-title"},Ke={class:"related-meta"},We={key:2,class:"sidebar-section"},He={class:"tag-cloud"},Je={key:0,class:"comments-section"},qe={key:1,class:"fixed-actions"},Ge={class:"action-text"},Qe={class:"action-text"},Xe={__name:"ArticleDetail",setup(Ze){const D=Z(),_=ie(),p=L(()=>D.params.id),t=m(null),k=m(!1),w=m([]),S=m(!1),T=m(!1),x=m(!1),C=m(!1),h=L(()=>{const e=p.value;return e?!/^\d+$/.test(e):!1}),y=L(()=>t.value&&t.value.id?t.value.id:h.value?null:p.value),E=()=>{S.value=window.innerWidth<768},j=e=>e?ve(e).format("YYYY-MM-DD"):"",F=e=>e.categoryName?e.categoryName:e.category&&e.category.name?e.category.name:"",R=e=>typeof e=="object"&&e!==null?e.name:e,M=async()=>{k.value=!0,t.value=null;try{const e=p.value;if(!e)throw new Error("文章标识符不能为空");let a;try{h.value?a=await me(e):a=await fe(e)}catch(l){throw console.error("API請求失敗:",{identifier:e,isSlug:h.value,apiBaseURL:"https://blog.hazenix.top/api",error:l,response:l.response,status:l.response?.status,statusText:l.response?.statusText,data:l.response?.data}),l}const o=a?.data||a;if(o&&(o.id||o.title)){t.value=o,t.value.slug&&!h.value&&p.value!==t.value.slug&&(C.value=!0,_.replace({name:"ArticleDetail",params:{id:t.value.slug}}).then(()=>{setTimeout(()=>{C.value=!1},100)}).catch(l=>{console.error("更新URL失敗:",l),C.value=!1}));try{const l=t.value.id;l&&await _e(l)}catch(l){console.warn("Failed to increment view count:",l)}try{await O()}catch(l){console.warn("Failed to load related articles:",l)}x.value&&(window.scrollTo({top:0,behavior:"smooth"}),x.value=!1)}else throw new Error("文章數據格式錯誤或為空")}catch(e){console.error("加載文章失敗:",e);let a="加載文章失敗",o=!0;if(e.response){const l=e.response.status;l===404?(a="文章不存在或已被刪除",_.push("/404").catch(()=>{}),o=!1):l===500?a="服務器內部錯誤，請稍後重試":l===403?a="沒有權限訪問該文章":l===401?a="未授權，請先登錄":a=`請求失敗 (${l})`}else e.code==="ECONNREFUSED"||e.code==="ERR_NETWORK"?(a="無法連接到服務器，請檢查網絡連接和API配置",console.error("API連接失敗，請檢查:",{apiBaseURL:oe(),identifier:p.value,isSlug:h.value})):e.message?.includes("timeout")||e.code==="ECONNABORTED"?a="請求超時，請檢查網絡連接":e.message&&(a=e.message);o&&f.error(a),t.value=null}finally{k.value=!1}},O=async()=>{try{const e=await ye(y.value,{limit:5});w.value=e.data}catch{}},N=async()=>{if(t.value)try{await he(y.value),t.value.isLiked=!t.value.isLiked;const e=t.value.likeCount||t.value.likes||0;t.value.likeCount=e+(t.value.isLiked?1:-1),t.value.likes=t.value.likeCount,f.success(t.value.isLiked?"点赞成功":"取消点赞")}catch{f.error("操作失败")}},B=async()=>{if(t.value)try{navigator.share?await navigator.share({title:t.value.title,text:t.value.summary||"",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),f.success("链接已复制到剪贴板"))}catch{f.error("分享失败")}},$=async()=>{if(t.value)try{await pe(y.value),t.value.isCollected=!t.value.isCollected,f.success(t.value.isCollected?"收藏成功":"取消收藏")}catch{f.error("操作失败")}},P=e=>{},V=e=>{t.value&&(t.value.commentCount=(t.value.commentCount||0)+1)},Y=e=>{if(typeof e=="object"&&e!==null){const a=e.slug||e.id;if(e.value&&(e.value.id===e.id||e.value.slug===a))return;_.push({name:"ArticleDetail",params:{id:a}})}else{if(e.value&&(e.value.id?.toString()===e?.toString()||e.value.id===e))return;_.push({name:"ArticleDetail",params:{id:e}})}},K=e=>{const a=t.value?.tags?.find(o=>typeof o=="object"&&o!==null?o.name===e:o===e);if(a){const o=typeof a=="object"?a.id:a;_.push(`/tag/${o}`)}else _.push(`/articles?tag=${encodeURIComponent(e)}`)},W=e=>{if(!e)return"暂无摘要";if(e.split("").length<=20)return e;const o=["代码孤岛漫行苦,星火聚源破迷途","技术探索无止境,创新思维启新程","知识分享传智慧,社区共建创未来","学习路上有你我,技术成长共前行"];return o[Math.floor(Math.random()*o.length)]},H=()=>{T.value=!T.value};return ee(()=>D.params.id,(e,a)=>{C.value||e!==a&&(t.value&&e&&(t.value.slug===e||t.value.id===e||t.value.id?.toString()===e||t.value.slug?.toString()===e)||e&&(t.value=null,w.value=[],x.value=!0,M()))}),te(()=>{E(),window.addEventListener("resize",E),M()}),ae(()=>{window.removeEventListener("resize",E)}),(e,a)=>{const o=g("Star"),l=g("el-icon"),J=g("el-button"),q=g("el-empty"),G=g("el-tag"),Q=le("loading");return n(),r("div",be,[se((n(),r("div",Se,[s("main",Te,[t.value?(n(),r("article",xe,[s("header",Ee,[s("h1",Le,u(t.value.title),1),i(ge,{"author-name":"Hazenix","created-at":t.value.createTime||t.value.createdAt,"updated-at":t.value.updatedAt||t.value.updateTime,content:t.value.content,views:t.value.viewCount||t.value.views||0,"category-name":F(t.value),tags:t.value.tags},null,8,["created-at","updated-at","content","views","category-name","tags"])]),t.value.summary?(n(),r("div",De,[s("div",Re,u(t.value.summary),1)])):v("",!0),t.value.summary?(n(),r("div",Me,[s("div",Ne,[s("div",Be,[i(l,{class:"ai-summary-icon"},{default:d(()=>[i(o)]),_:1}),a[1]||(a[1]=s("span",null,"AI Summary",-1))]),a[2]||(a[2]=s("div",{class:"ai-summary-powered"}," Powered By DeepSeek-R1 ",-1))]),s("div",$e,[a[3]||(a[3]=s("p",{class:"ai-summary-intro"},"以下是针对博客文章的深度解析与总结：",-1)),s("div",Ie,[i(l,{class:"ai-summary-bullet"},{default:d(()=>[i(o)]),_:1}),s("span",null,u(W(t.value.summary)),1)]),s("div",{class:"ai-summary-expand",onClick:H},[i(l,null,{default:d(()=>[i(b(ne))]),_:1}),s("span",null,u(T.value?"收起":"展开"),1)])])])):v("",!0),s("div",Ue,[i(ke,{content:t.value.content},null,8,["content"])])])):k.value?v("",!0):(n(),r("div",ze,[i(q,{description:"文章不存在或已被删除"},{default:d(()=>[i(J,{type:"primary",onClick:a[0]||(a[0]=c=>e.$router.push("/"))},{default:d(()=>[...a[4]||(a[4]=[z(" 返回首页 ",-1)])]),_:1})]),_:1})]))]),s("aside",je,[t.value?.content?(n(),r("div",Fe,[i(we,{content:t.value.content,"is-mobile":S.value,article:t.value,onTocClick:P,onLike:N,onCollect:$,onShare:B},null,8,["content","is-mobile","article"])])):v("",!0),w.value.length>0?(n(),r("div",Oe,[a[5]||(a[5]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"相关文章")],-1)),s("div",Pe,[(n(!0),r(I,null,U(w.value,c=>(n(),r("div",{key:c.id,class:"related-item",onClick:X=>Y(c)},[s("h4",Ye,u(c.title),1),s("p",Ke,u(j(c.createTime))+" · "+u(c.viewCount||0)+" 阅读 ",1)],8,Ve))),128))])])):v("",!0),t.value?.tags&&t.value.tags.length>0?(n(),r("div",We,[a[6]||(a[6]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"标签")],-1)),s("div",He,[(n(!0),r(I,null,U(t.value.tags,c=>(n(),re(G,{key:c.id||c,size:"small",class:"tag-item",onClick:X=>K(R(c))},{default:d(()=>[z(u(R(c)),1)]),_:2},1032,["onClick"]))),128))])])):v("",!0)])])),[[Q,k.value]]),y.value?(n(),r("div",Je,[i(Ce,{"article-id":y.value,onCommentAdded:V},null,8,["article-id"])])):v("",!0),t.value&&!S.value?(n(),r("div",qe,[s("div",{class:A(["action-item",{liked:t.value?.isLiked}]),onClick:N},[i(l,{class:A(["action-icon",{"text-red-500":t.value?.isLiked}])},{default:d(()=>[i(b(ce))]),_:1},8,["class"]),s("span",Ge,u(t.value?.likeCount||t.value?.likes||0),1)],2),s("div",{class:A(["action-item",{collected:t.value?.isCollected}]),onClick:$},[i(l,{class:A(["action-icon",{"text-green-500":t.value?.isCollected}])},{default:d(()=>[i(b(ue))]),_:1},8,["class"]),s("span",Qe,u(t.value?.isCollected?"已收藏":"收藏"),1)],2),s("div",{class:"action-item",onClick:B},[i(l,{class:"action-icon"},{default:d(()=>[i(b(de))]),_:1}),a[7]||(a[7]=s("span",{class:"action-text"},"分享",-1))])])):v("",!0)])}}},it=Ae(Xe,[["__scopeId","data-v-a2d70d74"]]);export{it as default};
