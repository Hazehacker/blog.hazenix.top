import{r as y,W as I,H as ie,j as de,c as z,o as i,b as o,a as l,w as s,f as d,z as ce,y as ue,A as pe,g as x,D as _,E as c,al as N,u as ge,l as n,h as S,aa as me,t as M,F as R,C as F,X as ye,B as V}from"./index-BBqYyNLz.js";import{a as f}from"./admin-D9Y3aL4T.js";import{T as _e}from"./ToastUIEditor-BGU61-2z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"space-y-6"},ve={class:"flex justify-between items-center"},he={class:"flex space-x-3"},be={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ke={class:"flex space-x-2"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},Ce={class:"flex items-center"},ze={class:"font-medium text-gray-900 dark:text-gray-100"},Se={class:"flex flex-wrap gap-1"},Ve={key:0,class:"text-xs text-gray-500"},Te={class:"flex space-x-2"},Ae={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},Be={class:"text-sm text-gray-500 dark:text-gray-400"},Ie={__name:"ArticleManagement",setup(De){const K=ge(),T=y(!1),D=y([]),$=y([]),L=y([]),k=y([]),A=y(0),p=I({keyword:"",categoryId:"",status:""}),r=I({page:1,pageSize:20}),v=y(!1),h=y(null),P=ie(()=>h.value?"编辑文章":"新建文章"),H=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),u=async()=>{T.value=!0;try{const a={page:r.page,pageSize:r.pageSize,...p},e=await f.getArticles(a);D.value=e.data.records,A.value=e.data.total}catch(a){console.error("加载文章列表失败:",a),c.error("加载文章列表失败")}finally{T.value=!1}},O=async()=>{try{const[a,e]=await Promise.all([f.getCategories(),f.getTags()]);$.value=a.data,L.value=e.data}catch(a){console.error("加载分类和标签失败:",a)}},U=()=>{r.page=1,u()},W=()=>{Object.assign(p,{keyword:"",categoryId:"",status:""}),r.page=1,u()},X=a=>{r.pageSize=a,r.page=1,u()},q=a=>{r.page=a,u()},G=a=>{k.value=a},J=()=>{h.value=null,v.value=!0},Q=a=>{h.value={...a},v.value=!0},Y=a=>{K.push(`/admin/articles/${a.id}`)},Z=async a=>{try{const e=a.status===0?2:0;await f.toggleArticleStatus(a.id,e),c.success(`${e===0?"发布":"下架"}成功`),u()}catch(e){console.error("切换文章状态失败:",e),c.error("操作失败")}},ee=async a=>{try{await N.confirm(`确定要删除文章"${a.title}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.deleteArticle(a.id),c.success("删除成功"),u()}catch(e){e!=="cancel"&&(console.error("删除文章失败:",e),c.error("删除失败"))}},te=async()=>{try{await N.confirm(`确定要删除选中的 ${k.value.length} 篇文章吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=k.value.map(e=>e.id);await f.batchDeleteArticles(a),c.success("批量删除成功"),u()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),c.error("批量删除失败"))}},ae=async a=>{try{h.value?(await f.updateArticle(h.value.id,a),c.success("更新成功")):(await f.createArticle(a),c.success("创建成功")),v.value=!1,u()}catch(e){console.error("保存文章失败:",e),c.error("保存失败")}},E=()=>{v.value=!1,h.value=null};return de(()=>{O(),u()}),(a,e)=>{const g=d("el-button"),w=d("el-icon"),le=d("el-input"),B=d("el-option"),j=d("el-select"),b=d("el-table-column"),C=d("el-tag"),se=d("el-table"),oe=d("el-pagination"),ne=d("el-dialog"),re=pe("loading");return i(),z("div",fe,[o("div",ve,[e[8]||(e[8]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"文章管理",-1)),o("div",he,[l(g,{onClick:te,type:"danger",disabled:k.value.length===0},{default:s(()=>[...e[6]||(e[6]=[n(" 批量删除 ",-1)])]),_:1},8,["disabled"]),l(g,{onClick:J,type:"primary"},{default:s(()=>[l(w,{class:"mr-1"},{default:s(()=>[l(S(me))]),_:1}),e[7]||(e[7]=n(" 新建文章 ",-1))]),_:1})])]),o("div",be,[o("div",xe,[l(le,{modelValue:p.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>p.keyword=t),placeholder:"搜索文章标题或内容",clearable:"",onKeyup:ce(U,["enter"])},{prefix:s(()=>[l(w,null,{default:s(()=>[l(S(M))]),_:1})]),_:1},8,["modelValue"]),l(j,{modelValue:p.categoryId,"onUpdate:modelValue":e[1]||(e[1]=t=>p.categoryId=t),placeholder:"选择分类",clearable:""},{default:s(()=>[(i(!0),z(R,null,F($.value,t=>(i(),x(B,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(j,{modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=t=>p.status=t),placeholder:"选择状态",clearable:""},{default:s(()=>[l(B,{label:"发布",value:"0"}),l(B,{label:"草稿",value:"2"})]),_:1},8,["modelValue"]),o("div",ke,[l(g,{onClick:U,type:"primary"},{default:s(()=>[l(w,{class:"mr-1"},{default:s(()=>[l(S(M))]),_:1}),e[9]||(e[9]=n(" 搜索 ",-1))]),_:1}),l(g,{onClick:W},{default:s(()=>[l(w,{class:"mr-1"},{default:s(()=>[l(S(ye))]),_:1}),e[10]||(e[10]=n(" 重置 ",-1))]),_:1})])])]),o("div",we,[ue((i(),x(se,{data:D.value,onSelectionChange:G,"row-key":"id"},{default:s(()=>[l(b,{type:"selection",width:"55"}),l(b,{prop:"title",label:"标题","min-width":"200"},{default:s(({row:t})=>[o("div",Ce,[o("span",ze,_(t.title),1),t.isTop?(i(),x(C,{key:0,type:"warning",size:"small",class:"ml-2"},{default:s(()=>[...e[11]||(e[11]=[n("置顶",-1)])]),_:1})):V("",!0)])]),_:1}),l(b,{prop:"category",label:"分类",width:"120"},{default:s(({row:t})=>[t.category?(i(),x(C,{key:0,type:"primary",size:"small"},{default:s(()=>[n(_(t.category.name),1)]),_:2},1024)):V("",!0)]),_:1}),l(b,{prop:"tags",label:"标签",width:"150"},{default:s(({row:t})=>[o("div",Se,[(i(!0),z(R,null,F(t.tags?.slice(0,2),m=>(i(),x(C,{key:m.id||m,size:"small",type:"info"},{default:s(()=>[n(_(m.name||m),1)]),_:2},1024))),128)),t.tags?.length>2?(i(),z("span",Ve," +"+_(t.tags.length-2),1)):V("",!0)])]),_:1}),l(b,{prop:"status",label:"状态",width:"100"},{default:s(({row:t})=>[l(C,{type:t.status===0?"success":"warning",size:"small"},{default:s(()=>[n(_(t.status===0?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"createTime",label:"创建时间",width:"180"},{default:s(({row:t})=>[n(_(H(t.createTime)),1)]),_:1}),l(b,{label:"操作",width:"235",fixed:"right"},{default:s(({row:t})=>[o("div",Te,[l(g,{onClick:m=>Y(t),size:"small",type:"primary",plain:""},{default:s(()=>[...e[12]||(e[12]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),l(g,{onClick:m=>Q(t),size:"small"},{default:s(()=>[...e[13]||(e[13]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{onClick:m=>Z(t),size:"small",type:t.status===0?"warning":"success"},{default:s(()=>[n(_(t.status===0?"下架":"发布"),1)]),_:2},1032,["onClick","type"]),l(g,{onClick:m=>ee(t),size:"small",type:"danger",plain:""},{default:s(()=>[...e[14]||(e[14]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[re,T.value]]),o("div",Ae,[o("div",Be," 共 "+_(A.value)+" 条记录 ",1),l(oe,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=t=>r.page=t),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>r.pageSize=t),"page-sizes":[10,20,50,100],total:A.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),l(ne,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=t=>v.value=t),title:P.value,width:"90%","close-on-click-modal":!1,onClose:E},{default:s(()=>[v.value?(i(),x(_e,{key:0,article:h.value,onSave:ae,onCancel:E},null,8,["article"])):V("",!0)]),_:1},8,["modelValue","title"])])}}};export{Ie as default};
