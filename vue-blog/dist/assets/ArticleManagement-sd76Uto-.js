import{r as g,X as R,j as ce,l as ue,c as k,o as i,b as o,a as l,w as s,d as u,H as pe,B as F,I as ge,g as b,t as _,K as d,aj as K,u as me,e as n,h as T,a7 as fe,x as D,F as L,n as P,Y as ye,J as V}from"./index-cinz6B6s.js";import{a as m}from"./admin-BqhwTfVE.js";import{T as _e}from"./ToastUIEditor-rmylegky.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"space-y-6"},he={class:"flex justify-between items-center"},xe={class:"flex space-x-3"},be={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ke={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},we={class:"flex space-x-2"},Ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},ze={class:"flex items-center"},Se={class:"font-medium text-gray-900 dark:text-gray-100"},Te={class:"flex flex-wrap gap-1"},Ve={key:0,class:"text-xs text-gray-500"},Ae={class:"flex space-x-2"},Be={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},$e={class:"text-sm text-gray-500 dark:text-gray-400"},Ie={style:{"min-height":"400px"}},Re={__name:"ArticleManagement",setup(Ue){const H=me(),A=g(!1),w=g(!1),I=g([]),U=g([]),J=g([]),C=g([]),B=g(0),f=R({keyword:"",categoryId:"",status:""}),r=R({page:1,pageSize:20}),v=g(!1),h=g(null),O=ce(()=>h.value?"编辑文章":"新建文章"),X=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=async()=>{A.value=!0;try{const t={page:r.page,pageSize:r.pageSize,...f},e=await m.getArticles(t);I.value=e.data.records,B.value=e.data.total}catch(t){console.error("加载文章列表失败:",t),d.error("加载文章列表失败")}finally{A.value=!1}},Y=async()=>{try{const[t,e]=await Promise.all([m.getCategories(),m.getTags()]);U.value=t.data,J.value=e.data}catch(t){console.error("加载分类和标签失败:",t)}},j=()=>{r.page=1,p()},q=()=>{Object.assign(f,{keyword:"",categoryId:"",status:""}),r.page=1,p()},G=t=>{r.pageSize=t,r.page=1,p()},Q=t=>{r.page=t,p()},W=t=>{C.value=t},Z=()=>{h.value=null,v.value=!0},ee=async t=>{try{w.value=!0;const e=await m.getArticle(t.id);h.value=e.data,v.value=!0}catch(e){console.error("获取文章详情失败:",e),d.error("获取文章详情失败")}finally{w.value=!1}},te=t=>{H.push(`/admin/articles/${t.id}`)},ae=async t=>{try{const e=t.status===0?2:0;console.log("切换文章状态:",{articleId:t.id,currentStatus:t.status,newStatus:e});const c=await m.toggleArticleStatus(t.id,e);console.log("切换状态响应:",c),d.success(`${e===0?"发布":"下架"}成功`),p()}catch(e){console.error("切换文章状态失败:",e),d.error("操作失败")}},le=async t=>{try{await K.confirm(`确定要删除文章"${t.title}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.deleteArticle(t.id),d.success("删除成功"),p()}catch(e){e!=="cancel"&&(console.error("删除文章失败:",e),d.error("删除失败"))}},se=async()=>{try{await K.confirm(`确定要删除选中的 ${C.value.length} 篇文章吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=C.value.map(e=>e.id);await m.batchDeleteArticles(t),d.success("批量删除成功"),p()}catch(t){t!=="cancel"&&(console.error("批量删除失败:",t),d.error("批量删除失败"))}},oe=async t=>{try{t.isTop===void 0||t.isTop===null?t.isTop=0:t.isTop=t.isTop===!0||t.isTop===1?1:0,console.log("准备保存文章数据:",t),h.value?(await m.updateArticle(h.value.id,t),d.success("更新成功")):(await m.createArticle(t),d.success("创建成功")),v.value=!1,p()}catch(e){console.error("保存文章失败:",e),d.error("保存失败")}},E=()=>{v.value=!1,h.value=null};return ue(()=>{Y(),p()}),(t,e)=>{const c=u("el-button"),z=u("el-icon"),ne=u("el-input"),$=u("el-option"),N=u("el-select"),x=u("el-table-column"),S=u("el-tag"),re=u("el-table"),ie=u("el-pagination"),de=u("el-dialog"),M=ge("loading");return i(),k("div",ve,[o("div",he,[e[8]||(e[8]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"文章管理",-1)),o("div",xe,[l(c,{onClick:se,type:"danger",disabled:C.value.length===0},{default:s(()=>[...e[6]||(e[6]=[n(" 批量删除 ",-1)])]),_:1},8,["disabled"]),l(c,{onClick:Z,type:"primary"},{default:s(()=>[l(z,{class:"mr-1"},{default:s(()=>[l(T(fe))]),_:1}),e[7]||(e[7]=n(" 新建文章 ",-1))]),_:1})])]),o("div",be,[o("div",ke,[l(ne,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>f.keyword=a),placeholder:"搜索文章标题或内容",clearable:"",onKeyup:pe(j,["enter"])},{prefix:s(()=>[l(z,null,{default:s(()=>[l(T(D))]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:f.categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>f.categoryId=a),placeholder:"选择分类",clearable:""},{default:s(()=>[(i(!0),k(L,null,P(U.value,a=>(i(),b($,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(N,{modelValue:f.status,"onUpdate:modelValue":e[2]||(e[2]=a=>f.status=a),placeholder:"选择状态",clearable:""},{default:s(()=>[l($,{label:"发布",value:"0"}),l($,{label:"草稿",value:"2"})]),_:1},8,["modelValue"]),o("div",we,[l(c,{onClick:j,type:"primary"},{default:s(()=>[l(z,{class:"mr-1"},{default:s(()=>[l(T(D))]),_:1}),e[9]||(e[9]=n(" 搜索 ",-1))]),_:1}),l(c,{onClick:q},{default:s(()=>[l(z,{class:"mr-1"},{default:s(()=>[l(T(ye))]),_:1}),e[10]||(e[10]=n(" 重置 ",-1))]),_:1})])])]),o("div",Ce,[F((i(),b(re,{data:I.value,onSelectionChange:W,"row-key":"id"},{default:s(()=>[l(x,{type:"selection",width:"55"}),l(x,{prop:"title",label:"标题","min-width":"200"},{default:s(({row:a})=>[o("div",ze,[o("span",Se,_(a.title),1),a.isTop?(i(),b(S,{key:0,type:"warning",size:"small",class:"ml-2"},{default:s(()=>[...e[11]||(e[11]=[n("置顶",-1)])]),_:1})):V("",!0)])]),_:1}),l(x,{prop:"category",label:"分类",width:"120"},{default:s(({row:a})=>[a.category?(i(),b(S,{key:0,type:"primary",size:"small"},{default:s(()=>[n(_(a.category.name),1)]),_:2},1024)):V("",!0)]),_:1}),l(x,{prop:"tags",label:"标签",width:"150"},{default:s(({row:a})=>[o("div",Te,[(i(!0),k(L,null,P(a.tags?.slice(0,2),y=>(i(),b(S,{key:y.id||y,size:"small",type:"info"},{default:s(()=>[n(_(y.name||y),1)]),_:2},1024))),128)),a.tags?.length>2?(i(),k("span",Ve," +"+_(a.tags.length-2),1)):V("",!0)])]),_:1}),l(x,{prop:"status",label:"状态",width:"100"},{default:s(({row:a})=>[l(S,{type:a.status===0?"success":"warning",size:"small"},{default:s(()=>[n(_(a.status===0?"已发布":"草稿"),1)]),_:2},1032,["type"])]),_:1}),l(x,{prop:"createTime",label:"创建时间",width:"180"},{default:s(({row:a})=>[n(_(X(a.createTime)),1)]),_:1}),l(x,{label:"操作",width:"235",fixed:"right"},{default:s(({row:a})=>[o("div",Ae,[l(c,{onClick:y=>te(a),size:"small",type:"primary",plain:""},{default:s(()=>[...e[12]||(e[12]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),l(c,{onClick:y=>ee(a),size:"small"},{default:s(()=>[...e[13]||(e[13]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(c,{onClick:y=>ae(a),size:"small",type:a.status===0?"warning":"success"},{default:s(()=>[n(_(a.status===0?"下架":"发布"),1)]),_:2},1032,["onClick","type"]),l(c,{onClick:y=>le(a),size:"small",type:"danger",plain:""},{default:s(()=>[...e[14]||(e[14]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[M,A.value]]),o("div",Be,[o("div",$e," 共 "+_(B.value)+" 条记录 ",1),l(ie,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=a=>r.page=a),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>r.pageSize=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),l(de,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),title:O.value,width:"90%","close-on-click-modal":!1,onClose:E},{default:s(()=>[F((i(),k("div",Ie,[v.value&&!w.value?(i(),b(_e,{key:0,article:h.value,onSave:oe,onCancel:E},null,8,["article"])):V("",!0)])),[[M,w.value]])]),_:1},8,["modelValue","title"])])}}};export{Re as default};
