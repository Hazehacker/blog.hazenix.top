import{r as m,X as B,j as ie,l as de,c as ue,o as N,b as o,a as t,w as s,d as n,H as ce,B as pe,I as me,g as ge,t as _,K as u,aj as K,e as i,h as k,a7 as fe,x as L,Y as _e,U as ve,D as ye}from"./index-cinz6B6s.js";import{a as b}from"./admin-BqhwTfVE.js";const be={class:"space-y-6"},xe={class:"flex justify-between items-center"},he={class:"flex space-x-3"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ke={class:"flex space-x-2"},Ve={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},ze={class:"flex items-center"},Se={class:"font-medium text-gray-900 dark:text-gray-100"},Ue={class:"text-gray-600 dark:text-gray-400"},Be={class:"flex space-x-2"},De={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},je={class:"text-sm text-gray-500 dark:text-gray-400"},Te={class:"flex justify-end space-x-3"},Ee={__name:"CategoryManagement",setup($e){const V=m(!1),z=m(!1),D=m([]),h=m([]),S=m(0),x=m(),v=B({keyword:"",status:""}),d=B({page:1,pageSize:20}),y=m(!1),g=m(null),O=ie(()=>g.value?"编辑分类":"新建分类"),r=B({name:"",slug:"",sort:0,status:0}),q={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:1,max:50,message:"分类名称长度在 1 到 50 个字符",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},F=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=async()=>{V.value=!0;try{const a={page:d.page,pageSize:d.pageSize,...v},e=await b.getCategories(a);D.value=e.data.records,S.value=e.data.total}catch(a){console.error("加载分类列表失败:",a),u.error("加载分类列表失败")}finally{V.value=!1}},j=()=>{d.page=1,c()},A=()=>{Object.assign(v,{keyword:"",status:""}),d.page=1,c()},H=a=>{d.pageSize=a,d.page=1,c()},I=a=>{d.page=a,c()},P=a=>{h.value=a},X=()=>{g.value=null,T(),y.value=!0},Y=a=>{g.value={...a},Object.assign(r,{name:a.name,sort:a.sort||0,slug:a.slug||"",status:a.status===null?0:a.status}),y.value=!0},G=async a=>{try{const e=a.status===null||a.status===0?1:0;await b.updateCategory(a.id,{status:e}),u.success(`${e===0?"启用":"禁用"}成功`),c()}catch(e){console.error("切换分类状态失败:",e),u.error("操作失败")}},J=async a=>{try{await K.confirm(`确定要删除分类"${a.name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.deleteCategory(a.id),u.success("删除成功"),c()}catch(e){e!=="cancel"&&(console.error("删除分类失败:",e),u.error("删除失败"))}},Q=async()=>{try{await K.confirm(`确定要删除选中的 ${h.value.length} 个分类吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=h.value.map(e=>e.id);await b.batchDeleteCategories(a),u.success("批量删除成功"),c()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),u.error("批量删除失败"))}},W=async()=>{if(x.value)try{await x.value.validate(),z.value=!0,g.value?(await b.updateCategory(g.value.id,r),u.success("更新成功")):(await b.createCategory(r),u.success("创建成功")),y.value=!1,c()}catch(a){a!==!1&&(console.error("保存分类失败:",a),u.error("保存失败"))}finally{z.value=!1}},T=()=>{Object.assign(r,{name:"",sort:0,slug:"",status:0}),x.value&&x.value.clearValidate()},$=()=>{y.value=!1,g.value=null,T()};return de(()=>{c()}),(a,e)=>{const p=n("el-button"),w=n("el-icon"),U=n("el-input"),M=n("el-option"),Z=n("el-select"),f=n("el-table-column"),ee=n("el-tag"),te=n("el-table"),ae=n("el-pagination"),C=n("el-form-item"),le=n("el-input-number"),R=n("el-radio"),se=n("el-radio-group"),oe=n("el-form"),ne=n("el-dialog"),re=me("loading");return N(),ue("div",be,[o("div",xe,[e[12]||(e[12]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"分类管理",-1)),o("div",he,[t(p,{onClick:Q,type:"danger",disabled:h.value.length===0},{default:s(()=>[...e[10]||(e[10]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(p,{onClick:X,type:"primary"},{default:s(()=>[t(w,{class:"mr-1"},{default:s(()=>[t(k(fe))]),_:1}),e[11]||(e[11]=i(" 新建分类 ",-1))]),_:1})])]),o("div",we,[o("div",Ce,[t(U,{modelValue:v.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>v.keyword=l),placeholder:"搜索分类名称或描述",clearable:"",onKeyup:ce(j,["enter"])},{prefix:s(()=>[t(w,null,{default:s(()=>[t(k(L))]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:v.status,"onUpdate:modelValue":e[1]||(e[1]=l=>v.status=l),placeholder:"选择状态",clearable:""},{default:s(()=>[t(M,{label:"启用",value:"0"}),t(M,{label:"禁用",value:"1"})]),_:1},8,["modelValue"]),o("div",ke,[t(p,{onClick:j,type:"primary"},{default:s(()=>[t(w,{class:"mr-1"},{default:s(()=>[t(k(L))]),_:1}),e[13]||(e[13]=i(" 搜索 ",-1))]),_:1}),t(p,{onClick:A},{default:s(()=>[t(w,{class:"mr-1"},{default:s(()=>[t(k(_e))]),_:1}),e[14]||(e[14]=i(" 重置 ",-1))]),_:1})])])]),o("div",Ve,[pe((N(),ge(te,{data:D.value,onSelectionChange:P,"row-key":"id"},{default:s(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"分类名称","min-width":"150"},{default:s(({row:l})=>[o("div",ze,[o("div",{class:"w-4 h-4 rounded mr-2",style:ve({backgroundColor:l.color})},null,4),o("span",Se,_(l.name),1)])]),_:1}),t(f,{prop:"slug",label:"URL标识符","min-width":"200"},{default:s(({row:l})=>[o("span",Ue,_(l.slug||"-"),1)]),_:1}),t(f,{prop:"sort",label:"排序",width:"100"}),t(f,{prop:"status",label:"状态",width:"100"},{default:s(({row:l})=>[t(ee,{type:l.status===0?"success":"danger",size:"small"},{default:s(()=>[i(_(l.status===0?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createTime",label:"创建时间",width:"180"},{default:s(({row:l})=>[i(_(F(l.createTime)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:s(({row:l})=>[o("div",Be,[t(p,{onClick:E=>Y(l),size:"small"},{default:s(()=>[...e[15]||(e[15]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(p,{onClick:E=>G(l),size:"small",type:l.status===0?"warning":"success"},{default:s(()=>[i(_(l.status===0?"禁用":"启用"),1)]),_:2},1032,["onClick","type"]),t(p,{onClick:E=>J(l),size:"small",type:"danger",plain:""},{default:s(()=>[...e[16]||(e[16]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[re,V.value]]),o("div",De,[o("div",je," 共 "+_(S.value)+" 条记录 ",1),t(ae,{"current-page":d.page,"onUpdate:currentPage":e[2]||(e[2]=l=>d.page=l),"page-size":d.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>d.pageSize=l),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:I},null,8,["current-page","page-size","total"])])]),t(ne,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=l=>y.value=l),title:O.value,width:"500px","close-on-click-modal":!1,onClose:$},{footer:s(()=>[o("div",Te,[t(p,{onClick:$},{default:s(()=>[...e[19]||(e[19]=[i("取消",-1)])]),_:1}),t(p,{onClick:W,type:"primary",loading:z.value},{default:s(()=>[i(_(g.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:s(()=>[t(oe,{ref_key:"formRef",ref:x,model:r,rules:q,"label-width":"80px",onSubmit:e[8]||(e[8]=ye(()=>{},["prevent"]))},{default:s(()=>[t(C,{label:"分类名称",prop:"name"},{default:s(()=>[t(U,{modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=l=>r.name=l),placeholder:"请输入分类名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(C,{label:"slug",prop:"slug"},{default:s(()=>[t(U,{modelValue:r.slug,"onUpdate:modelValue":e[5]||(e[5]=l=>r.slug=l),type:"textarea",rows:1,placeholder:"请输入该分类的URL标识符",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(C,{label:"排序",prop:"sort"},{default:s(()=>[t(le,{modelValue:r.sort,"onUpdate:modelValue":e[6]||(e[6]=l=>r.sort=l),min:0,max:9999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(C,{label:"状态",prop:"status"},{default:s(()=>[t(se,{modelValue:r.status,"onUpdate:modelValue":e[7]||(e[7]=l=>r.status=l)},{default:s(()=>[t(R,{value:"0"},{default:s(()=>[...e[17]||(e[17]=[i("启用",-1)])]),_:1}),t(R,{value:"1"},{default:s(()=>[...e[18]||(e[18]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{Ee as default};
