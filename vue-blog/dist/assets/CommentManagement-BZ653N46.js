import{r as b,S as P,o as ne,c as h,f as s,e as l,l as n,j as v,C as oe,B as re,A as de,k as w,G as d,H as c,b as u,q as r,n as C,y as q,F as ie,E as ce,T as ue,D as _,a8 as z}from"./index-BjRrW_j8.js";import{a as x}from"./admin-C4GflvBV.js";import{a as pe}from"./avatar-Br5af8Id.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"space-y-6"},ye={class:"flex justify-between items-center"},ve={class:"flex space-x-3"},fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},_e={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},xe={class:"flex space-x-2"},ke={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},be={class:"flex items-center"},he=["src"],we={class:"font-medium text-gray-900 dark:text-gray-100"},Ce={class:"max-w-xs"},ze={class:"text-gray-900 dark:text-gray-100 line-clamp-2"},Se={key:0,class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Te={class:"max-w-xs"},Ve={class:"text-sm text-gray-900 dark:text-gray-100 line-clamp-1"},Be={class:"flex space-x-2"},De={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},$e={class:"text-sm text-gray-500 dark:text-gray-400"},je={key:0,class:"space-y-4"},Me={class:"flex items-center space-x-3 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"},Ae=["src"],Ie={class:"font-medium text-gray-900 dark:text-gray-100"},Ue={class:"text-sm text-gray-500 dark:text-gray-400"},Ne={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Ee={class:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Fe={key:0,class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Re={class:"text-gray-700 dark:text-gray-300"},Ke={key:1,class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Le={class:"flex items-center space-x-2"},Pe={class:"text-gray-700 dark:text-gray-300"},qe={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Ge={class:"grid grid-cols-2 gap-4 text-sm"},He={class:"ml-2 text-gray-700 dark:text-gray-300"},Oe={class:"flex justify-end space-x-3"},Je={__name:"CommentManagement",setup(Qe){const S=b(!1),$=b([]),j=b([]),m=b([]),T=b(0),M=pe,f=P({keyword:"",status:"",articleId:""}),p=P({page:1,pageSize:20}),y=b(!1),o=b(null),A=t=>new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),I=t=>({0:"正常",1:"已删除"})[t]||"info",U=t=>({0:"正常",1:"已删除"})[t]||"未知",g=async()=>{S.value=!0;try{const t={page:p.page,pageSize:p.pageSize,...f},e=await x.getComments(t);$.value=e.data.list,T.value=e.data.total}catch(t){console.error("加载评论列表失败:",t),c.error("加载评论列表失败")}finally{S.value=!1}},G=async()=>{try{const t=await x.getArticles({pageSize:100});j.value=t.data.list}catch(t){console.error("加载文章列表失败:",t)}},N=()=>{p.page=1,g()},H=()=>{Object.assign(f,{keyword:"",status:"",articleId:""}),p.page=1,g()},O=t=>{p.pageSize=t,p.page=1,g()},J=t=>{p.page=t,g()},Q=t=>{m.value=t},W=t=>{o.value=t,y.value=!0},E=async t=>{try{await x.updateCommentStatus(t.id,"approved"),c.success("评论已通过"),g(),y.value&&(y.value=!1)}catch(e){console.error("通过评论失败:",e),c.error("操作失败")}},F=async t=>{try{await x.updateCommentStatus(t.id,"rejected"),c.success("评论已拒绝"),g(),y.value&&(y.value=!1)}catch(e){console.error("拒绝评论失败:",e),c.error("操作失败")}},R=async t=>{try{await z.confirm("确定要删除这条评论吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.deleteComment(t.id),c.success("删除成功"),g(),y.value&&(y.value=!1)}catch(e){e!=="cancel"&&(console.error("删除评论失败:",e),c.error("删除失败"))}},X=async()=>{try{await z.confirm(`确定要通过选中的 ${m.value.length} 条评论吗？`,"确认批量通过",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=m.value.map(e=>e.id);await x.batchApproveComments(t),c.success("批量通过成功"),g()}catch(t){t!=="cancel"&&(console.error("批量通过失败:",t),c.error("批量通过失败"))}},Y=async()=>{try{await z.confirm(`确定要拒绝选中的 ${m.value.length} 条评论吗？`,"确认批量拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=m.value.map(e=>e.id);await x.batchRejectComments(t),c.success("批量拒绝成功"),g()}catch(t){t!=="cancel"&&(console.error("批量拒绝失败:",t),c.error("批量拒绝失败"))}},Z=async()=>{try{await z.confirm(`确定要删除选中的 ${m.value.length} 条评论吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=m.value.map(e=>e.id);await x.batchDeleteComments(t),c.success("批量删除成功"),g()}catch(t){t!=="cancel"&&(console.error("批量删除失败:",t),c.error("批量删除失败"))}};return ne(()=>{G(),g()}),(t,e)=>{const i=v("el-button"),V=v("el-icon"),ee=v("el-input"),B=v("el-option"),K=v("el-select"),k=v("el-table-column"),L=v("el-tag"),te=v("el-table"),ae=v("el-pagination"),se=v("el-dialog"),le=de("loading");return u(),h("div",me,[s("div",ye,[e[13]||(e[13]=s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"评论管理",-1)),s("div",ve,[l(i,{onClick:X,type:"success",disabled:m.value.length===0},{default:n(()=>[...e[10]||(e[10]=[r(" 批量通过 ",-1)])]),_:1},8,["disabled"]),l(i,{onClick:Y,type:"warning",disabled:m.value.length===0},{default:n(()=>[...e[11]||(e[11]=[r(" 批量拒绝 ",-1)])]),_:1},8,["disabled"]),l(i,{onClick:Z,type:"danger",disabled:m.value.length===0},{default:n(()=>[...e[12]||(e[12]=[r(" 批量删除 ",-1)])]),_:1},8,["disabled"])])]),s("div",fe,[s("div",_e,[l(ee,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>f.keyword=a),placeholder:"搜索评论内容或作者",clearable:"",onKeyup:oe(N,["enter"])},{prefix:n(()=>[l(V,null,{default:n(()=>[l(C(q))]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:f.status,"onUpdate:modelValue":e[1]||(e[1]=a=>f.status=a),placeholder:"选择状态",clearable:""},{default:n(()=>[l(B,{label:"正常",value:"0"}),l(B,{label:"已删除",value:"1"})]),_:1},8,["modelValue"]),l(K,{modelValue:f.articleId,"onUpdate:modelValue":e[2]||(e[2]=a=>f.articleId=a),placeholder:"选择文章",clearable:""},{default:n(()=>[(u(!0),h(ie,null,ce(j.value,a=>(u(),w(B,{key:a.id,label:a.title,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s("div",xe,[l(i,{onClick:N,type:"primary"},{default:n(()=>[l(V,{class:"mr-1"},{default:n(()=>[l(C(q))]),_:1}),e[14]||(e[14]=r(" 搜索 ",-1))]),_:1}),l(i,{onClick:H},{default:n(()=>[l(V,{class:"mr-1"},{default:n(()=>[l(C(ue))]),_:1}),e[15]||(e[15]=r(" 重置 ",-1))]),_:1})])])]),s("div",ke,[re((u(),w(te,{data:$.value,onSelectionChange:Q,"row-key":"id"},{default:n(()=>[l(k,{type:"selection",width:"55"}),l(k,{prop:"username",label:"评论者",width:"120"},{default:n(({row:a})=>[s("div",be,[s("img",{src:a.avatar||C(M),alt:"头像",class:"w-8 h-8 rounded-full mr-2"},null,8,he),s("span",we,d(a.username),1)])]),_:1}),l(k,{prop:"content",label:"评论内容","min-width":"300"},{default:n(({row:a})=>[s("div",Ce,[s("p",ze,d(a.content),1),a.replyId?(u(),h("div",Se," 回复: "+d(a.replyUsername),1)):_("",!0)])]),_:1}),l(k,{prop:"articleTitle",label:"所属文章",width:"200"},{default:n(({row:a})=>[s("div",Te,[s("p",Ve,d(a.articleTitle||"-"),1)])]),_:1}),l(k,{prop:"status",label:"状态",width:"100"},{default:n(({row:a})=>[l(L,{type:I(a.status),size:"small"},{default:n(()=>[r(d(U(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(k,{prop:"createTime",label:"评论时间",width:"180"},{default:n(({row:a})=>[r(d(A(a.createTime)),1)]),_:1}),l(k,{label:"操作",width:"200",fixed:"right"},{default:n(({row:a})=>[s("div",Be,[l(i,{onClick:D=>W(a),size:"small",type:"primary",plain:""},{default:n(()=>[...e[16]||(e[16]=[r(" 查看 ",-1)])]),_:1},8,["onClick"]),a.status==="pending"?(u(),w(i,{key:0,onClick:D=>E(a),size:"small",type:"success"},{default:n(()=>[...e[17]||(e[17]=[r(" 通过 ",-1)])]),_:1},8,["onClick"])):_("",!0),a.status==="pending"?(u(),w(i,{key:1,onClick:D=>F(a),size:"small",type:"warning"},{default:n(()=>[...e[18]||(e[18]=[r(" 拒绝 ",-1)])]),_:1},8,["onClick"])):_("",!0),l(i,{onClick:D=>R(a),size:"small",type:"danger",plain:""},{default:n(()=>[...e[19]||(e[19]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[le,S.value]]),s("div",De,[s("div",$e," 共 "+d(T.value)+" 条记录 ",1),l(ae,{"current-page":p.page,"onUpdate:currentPage":e[3]||(e[3]=a=>p.page=a),"page-size":p.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>p.pageSize=a),"page-sizes":[10,20,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),l(se,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>y.value=a),title:"评论详情",width:"600px","close-on-click-modal":!1},{footer:n(()=>[s("div",Oe,[l(i,{onClick:e[5]||(e[5]=a=>y.value=!1)},{default:n(()=>[...e[26]||(e[26]=[r("关闭",-1)])]),_:1}),o.value?.status==="pending"?(u(),w(i,{key:0,onClick:e[6]||(e[6]=a=>E(o.value)),type:"success"},{default:n(()=>[...e[27]||(e[27]=[r(" 通过 ",-1)])]),_:1})):_("",!0),o.value?.status==="pending"?(u(),w(i,{key:1,onClick:e[7]||(e[7]=a=>F(o.value)),type:"warning"},{default:n(()=>[...e[28]||(e[28]=[r(" 拒绝 ",-1)])]),_:1})):_("",!0),l(i,{onClick:e[8]||(e[8]=a=>R(o.value)),type:"danger"},{default:n(()=>[...e[29]||(e[29]=[r(" 删除 ",-1)])]),_:1})])]),default:n(()=>[o.value?(u(),h("div",je,[s("div",Me,[s("img",{src:o.value.avatar||C(M),alt:"头像",class:"w-12 h-12 rounded-full"},null,8,Ae),s("div",null,[s("h3",Ie,d(o.value.username),1),s("p",Ue,d(A(o.value.createTime)),1)])]),s("div",Ne,[e[20]||(e[20]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"评论内容",-1)),s("p",Ee,d(o.value.content),1)]),o.value.articleTitle?(u(),h("div",Fe,[e[21]||(e[21]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"所属文章",-1)),s("p",Re,d(o.value.articleTitle),1)])):_("",!0),o.value.replyId?(u(),h("div",Ke,[e[22]||(e[22]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"回复对象",-1)),s("div",Le,[s("span",Pe,d(o.value.replyUsername),1)])])):_("",!0),s("div",qe,[e[25]||(e[25]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"其他信息",-1)),s("div",Ge,[s("div",null,[e[23]||(e[23]=s("span",{class:"text-gray-500 dark:text-gray-400"},"IP地址:",-1)),s("span",He,d(o.value.ip||"-"),1)]),s("div",null,[e[24]||(e[24]=s("span",{class:"text-gray-500 dark:text-gray-400"},"状态:",-1)),l(L,{type:I(o.value.status),size:"small",class:"ml-2"},{default:n(()=>[r(d(U(o.value.status)),1)]),_:1},8,["type"])])])])])):_("",!0)]),_:1},8,["modelValue"])])}}},et=ge(Je,[["__scopeId","data-v-653883b2"]]);export{et as default};
