import{r as _,X as U,j as me,a4 as ge,ad as fe,l as _e,c as M,o as S,b as s,J as ve,a as t,w as o,d as r,H as be,t as v,B as ye,I as xe,g as ke,K as i,aj as N,e as d,h as C,a7 as we,x as R,Y as he}from"./index-Cr_Or7lo.js";import{a as k}from"./admin-DOO57u4q.js";import{b as Ve}from"./helpers-DVd64Rx3.js";import{a as F}from"./avatar-Br5af8Id.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"space-y-6"},Le={class:"flex justify-between items-center"},Ue={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Se={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},je={key:0,class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4"},Be={class:"flex items-center justify-between"},De={class:"text-blue-700 dark:text-blue-300"},Te={class:"space-x-2"},$e={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},Ee={class:"flex items-center space-x-3"},Ae=["src","alt"],Me={class:"font-medium text-gray-900 dark:text-gray-100"},Ne={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"space-x-2"},Fe={class:"flex justify-center p-4"},Ie={class:"flex items-center space-x-4"},Ke=["src"],qe={class:"flex justify-end space-x-2"},He={__name:"LinkManagement",setup(Oe){const z=_(!1),L=_(!1),b=_(!1),y=_(null),m=_([]),g=U({keyword:"",status:null}),u=U({page:1,size:20,total:0}),j=_([]),n=U({name:"",description:"",url:"",avatar:"",sort:0,status:0}),I={name:[{required:!0,message:"请输入网站名称",trigger:"blur"},{max:48,message:"网站名称不能超过48个字符",trigger:"blur"}],description:[{max:255,message:"描述不能超过255个字符",trigger:"blur"}],url:[{required:!0,message:"请输入网站地址",trigger:"blur"},{type:"url",message:"请输入正确的URL格式",trigger:"blur"}],sort:[{type:"number",message:"排序必须为数字",trigger:"blur"}]},K=me(()=>ge("/common/upload")),q={Authorization:`Bearer ${fe()}`},H=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=async()=>{z.value=!0;try{const a={page:u.page,size:u.size,...g},e=await k.getLinks(a);j.value=e.data.records||e.data,u.total=e.data.total||0}catch{i.error("加载友链列表失败")}finally{z.value=!1}},w=()=>{u.page=1,p()},O=()=>{g.keyword="",g.status=null,u.page=1,p()},P=a=>{u.page=a,p()},J=a=>{u.size=a,u.page=1,p()},X=a=>{m.value=a},Y=a=>{y.value=a,Object.assign(n,{name:a.name,description:a.description,url:a.url,avatar:a.avatar,sort:a.sort,status:a.status}),b.value=!0},G=async a=>{try{const e=a.status===0?1:0;await k.updateLinkStatus(a.id,e),i.success("状态更新成功"),p()}catch{i.error("更新状态失败")}},Q=async a=>{try{await N.confirm(`确定要删除友链"${a.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.deleteLink(a.id),i.success("删除成功"),p()}catch(e){e!=="cancel"&&i.error("删除失败")}},W=async()=>{if(m.value.length===0){i.warning("请先选择要删除的友链");return}try{await N.confirm(`确定要删除选中的 ${m.value.length} 个友链吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=m.value.map(e=>e.id);await k.batchDeleteLinks(a),i.success("批量删除成功"),m.value=[],p()}catch(a){a!=="cancel"&&i.error("批量删除失败")}},Z=()=>{y.value=null,Object.assign(n,{name:"",description:"",url:"",avatar:"",sort:0,status:0})},ee=async()=>{try{await T.value.validate(),L.value=!0,y.value?(await k.updateLink(y.value.id,n),i.success("更新成功")):(await k.createLink(n),i.success("创建成功")),b.value=!1,p()}catch{i.error("操作失败")}finally{L.value=!1}},te=a=>{a.code===200?(n.avatar=a.data.url,i.success("上传成功")):i.error(a.message||"上传失败")},ae=a=>{i.error("上传失败")},B=a=>Ve(a,F),D=a=>{a.target.src=F},T=_();return _e(()=>{p()}),(a,e)=>{const h=r("el-icon"),c=r("el-button"),V=r("el-input"),$=r("el-option"),le=r("el-select"),f=r("el-table-column"),oe=r("el-tag"),se=r("el-table"),ne=r("el-pagination"),x=r("el-form-item"),re=r("el-upload"),ie=r("el-input-number"),E=r("el-radio"),de=r("el-radio-group"),ue=r("el-form"),ce=r("el-dialog"),pe=xe("loading");return S(),M("div",ze,[s("div",Le,[e[13]||(e[13]=s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"友链管理",-1)),t(c,{type:"primary",onClick:e[0]||(e[0]=l=>b.value=!0)},{default:o(()=>[t(h,{class:"mr-2"},{default:o(()=>[t(C(we))]),_:1}),e[12]||(e[12]=d(" 添加友链 ",-1))]),_:1})]),s("div",Ue,[s("div",Se,[t(V,{modelValue:g.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>g.keyword=l),placeholder:"搜索网站名称或描述",clearable:"",onClear:w,onKeyup:be(w,["enter"])},{prefix:o(()=>[t(h,null,{default:o(()=>[t(C(R))]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:g.status,"onUpdate:modelValue":e[2]||(e[2]=l=>g.status=l),placeholder:"选择状态",clearable:"",onChange:w},{default:o(()=>[t($,{label:"正常",value:0}),t($,{label:"审核中",value:1})]),_:1},8,["modelValue"]),t(c,{type:"primary",onClick:w},{default:o(()=>[t(h,{class:"mr-2"},{default:o(()=>[t(C(R))]),_:1}),e[14]||(e[14]=d(" 搜索 ",-1))]),_:1}),t(c,{onClick:O},{default:o(()=>[t(h,{class:"mr-2"},{default:o(()=>[t(C(he))]),_:1}),e[15]||(e[15]=d(" 重置 ",-1))]),_:1})])]),m.value.length>0?(S(),M("div",je,[s("div",Be,[s("span",De," 已选择 "+v(m.value.length)+" 个友链 ",1),s("div",Te,[t(c,{size:"small",type:"danger",onClick:W},{default:o(()=>[...e[16]||(e[16]=[d("批量删除",-1)])]),_:1})])])])):ve("",!0),s("div",$e,[ye((S(),ke(se,{data:j.value,onSelectionChange:X,"row-key":"id",stripe:""},{default:o(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"网站名称","min-width":"120"},{default:o(({row:l})=>[s("div",Ee,[s("img",{src:B(l.avatar),alt:l.name,class:"w-8 h-8 rounded-full object-cover border border-gray-200 dark:border-gray-600",onError:D},null,40,Ae),s("div",null,[s("div",Me,v(l.name),1),s("div",Ne,v(l.url),1)])])]),_:1}),t(f,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(f,{prop:"sort",label:"排序",width:"80",align:"center"}),t(f,{prop:"status",label:"状态",width:"100",align:"center"},{default:o(({row:l})=>[t(oe,{type:l.status===0?"success":"warning",size:"small"},{default:o(()=>[d(v(l.status===0?"正常":"审核中"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createTime",label:"创建时间",width:"160"},{default:o(({row:l})=>[d(v(H(l.createTime)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[s("div",Re,[t(c,{size:"small",onClick:A=>Y(l)},{default:o(()=>[...e[17]||(e[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:l.status===0?"warning":"success",onClick:A=>G(l)},{default:o(()=>[d(v(l.status===0?"审核":"通过"),1)]),_:2},1032,["type","onClick"]),t(c,{size:"small",type:"danger",onClick:A=>Q(l)},{default:o(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[pe,z.value]]),s("div",Fe,[t(ne,{"current-page":u.page,"onUpdate:currentPage":e[3]||(e[3]=l=>u.page=l),"page-size":u.size,"onUpdate:pageSize":e[4]||(e[4]=l=>u.size=l),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:P},null,8,["current-page","page-size","total"])])]),t(ce,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=l=>b.value=l),title:y.value?"编辑友链":"添加友链",width:"600px",onClose:Z},{footer:o(()=>[s("div",qe,[t(c,{onClick:e[10]||(e[10]=l=>b.value=!1)},{default:o(()=>[...e[22]||(e[22]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:ee,loading:L.value},{default:o(()=>[d(v(y.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:o(()=>[t(ue,{ref_key:"formRef",ref:T,model:n,rules:I,"label-width":"100px"},{default:o(()=>[t(x,{label:"网站名称",prop:"name"},{default:o(()=>[t(V,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=l=>n.name=l),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"网站描述",prop:"description"},{default:o(()=>[t(V,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.description=l),type:"textarea",rows:3,placeholder:"请输入网站描述"},null,8,["modelValue"])]),_:1}),t(x,{label:"网站地址",prop:"url"},{default:o(()=>[t(V,{modelValue:n.url,"onUpdate:modelValue":e[7]||(e[7]=l=>n.url=l),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1}),t(x,{label:"头像",prop:"avatar"},{default:o(()=>[s("div",Ie,[s("img",{src:B(n.avatar),alt:"头像预览",class:"w-16 h-16 rounded-full object-cover border border-gray-200 dark:border-gray-600",onError:D},null,40,Ke),t(re,{action:K.value,headers:q,"show-file-list":!1,"on-success":te,"on-error":ae,accept:"image/*"},{default:o(()=>[t(c,{type:"primary",plain:""},{default:o(()=>[...e[19]||(e[19]=[d("上传头像",-1)])]),_:1})]),_:1},8,["action"])])]),_:1}),t(x,{label:"排序",prop:"sort"},{default:o(()=>[t(ie,{modelValue:n.sort,"onUpdate:modelValue":e[8]||(e[8]=l=>n.sort=l),min:0,max:9999},null,8,["modelValue"])]),_:1}),t(x,{label:"状态",prop:"status"},{default:o(()=>[t(de,{modelValue:n.status,"onUpdate:modelValue":e[9]||(e[9]=l=>n.status=l)},{default:o(()=>[t(E,{label:0},{default:o(()=>[...e[20]||(e[20]=[d("正常",-1)])]),_:1}),t(E,{label:1},{default:o(()=>[...e[21]||(e[21]=[d("审核中",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Qe=Ce(He,[["__scopeId","data-v-fd6fadf9"]]);export{Qe as default};
