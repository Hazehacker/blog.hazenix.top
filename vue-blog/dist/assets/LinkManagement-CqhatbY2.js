import{r as _,W as B,ag as ce,j as pe,c as z,o as k,b as n,B as j,a as t,w as o,f as r,z as me,D as v,y as ge,A as fe,g as _e,E as i,al as N,l as d,h as L,aa as ve,t as A,X as ye}from"./index-CxeTFetW.js";import{a as h}from"./admin-DY__4pks.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"space-y-6"},he={class:"flex justify-between items-center"},ke={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},we={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ve={key:0,class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4"},Ce={class:"flex items-center justify-between"},ze={class:"text-blue-700 dark:text-blue-300"},Le={class:"space-x-2"},Ue={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},Se={class:"flex items-center space-x-3"},Be=["src","alt"],je={class:"font-medium text-gray-900 dark:text-gray-100"},De={class:"text-sm text-gray-500 dark:text-gray-400"},Te={class:"space-x-2"},$e={class:"flex justify-center p-4"},Ee={class:"flex items-center space-x-4"},Me=["src"],Ne={class:"flex justify-end space-x-2"},Ae="/api/common/upload",Re={__name:"LinkManagement",setup(Fe){const U=_(!1),S=_(!1),y=_(!1),b=_(null),m=_([]),g=B({keyword:"",status:null}),u=B({page:1,size:20,total:0}),D=_([]),s=B({name:"",description:"",url:"",avatar:"",sort:0,status:0}),R={name:[{required:!0,message:"请输入网站名称",trigger:"blur"},{max:48,message:"网站名称不能超过48个字符",trigger:"blur"}],description:[{max:255,message:"描述不能超过255个字符",trigger:"blur"}],url:[{required:!0,message:"请输入网站地址",trigger:"blur"},{type:"url",message:"请输入正确的URL格式",trigger:"blur"}],sort:[{type:"number",message:"排序必须为数字",trigger:"blur"}]},F={Authorization:`Bearer ${ce()}`},q=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),p=async()=>{U.value=!0;try{const a={page:u.page,size:u.size,...g},e=await h.getLinks(a);D.value=e.data.records||e.data,u.total=e.data.total||0}catch(a){console.error("加载友链列表失败:",a),i.error("加载友链列表失败")}finally{U.value=!1}},w=()=>{u.page=1,p()},I=()=>{g.keyword="",g.status=null,u.page=1,p()},K=a=>{u.page=a,p()},O=a=>{u.size=a,u.page=1,p()},P=a=>{m.value=a},H=a=>{b.value=a,Object.assign(s,{name:a.name,description:a.description,url:a.url,avatar:a.avatar,sort:a.sort,status:a.status}),y.value=!0},W=async a=>{try{const e=a.status===0?1:0;await h.updateLinkStatus(a.id,e),i.success("状态更新成功"),p()}catch(e){console.error("更新状态失败:",e),i.error("更新状态失败")}},X=async a=>{try{await N.confirm(`确定要删除友链"${a.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.deleteLink(a.id),i.success("删除成功"),p()}catch(e){e!=="cancel"&&(console.error("删除友链失败:",e),i.error("删除失败"))}},G=async()=>{if(m.value.length===0){i.warning("请先选择要删除的友链");return}try{await N.confirm(`确定要删除选中的 ${m.value.length} 个友链吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=m.value.map(e=>e.id);await h.batchDeleteLinks(a),i.success("批量删除成功"),m.value=[],p()}catch(a){a!=="cancel"&&(console.error("批量删除失败:",a),i.error("批量删除失败"))}},J=()=>{b.value=null,Object.assign(s,{name:"",description:"",url:"",avatar:"",sort:0,status:0})},Q=async()=>{try{await T.value.validate(),S.value=!0,b.value?(await h.updateLink(b.value.id,s),i.success("更新成功")):(await h.createLink(s),i.success("创建成功")),y.value=!1,p()}catch(a){console.error("提交失败:",a),i.error("操作失败")}finally{S.value=!1}},Y=a=>{a.code===200?(s.avatar=a.data.url,i.success("上传成功")):i.error(a.message||"上传失败")},Z=a=>{console.error("上传失败:",a),i.error("上传失败")},ee=a=>{a.target.src="/default-avatar.png"},T=_();return pe(()=>{p()}),(a,e)=>{const V=r("el-icon"),c=r("el-button"),C=r("el-input"),$=r("el-option"),te=r("el-select"),f=r("el-table-column"),ae=r("el-tag"),le=r("el-table"),oe=r("el-pagination"),x=r("el-form-item"),se=r("el-upload"),ne=r("el-input-number"),E=r("el-radio"),re=r("el-radio-group"),ie=r("el-form"),de=r("el-dialog"),ue=fe("loading");return k(),z("div",xe,[n("div",he,[e[13]||(e[13]=n("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"友链管理",-1)),t(c,{type:"primary",onClick:e[0]||(e[0]=l=>y.value=!0)},{default:o(()=>[t(V,{class:"mr-2"},{default:o(()=>[t(L(ve))]),_:1}),e[12]||(e[12]=d(" 添加友链 ",-1))]),_:1})]),n("div",ke,[n("div",we,[t(C,{modelValue:g.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>g.keyword=l),placeholder:"搜索网站名称或描述",clearable:"",onClear:w,onKeyup:me(w,["enter"])},{prefix:o(()=>[t(V,null,{default:o(()=>[t(L(A))]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:g.status,"onUpdate:modelValue":e[2]||(e[2]=l=>g.status=l),placeholder:"选择状态",clearable:"",onChange:w},{default:o(()=>[t($,{label:"正常",value:0}),t($,{label:"审核中",value:1})]),_:1},8,["modelValue"]),t(c,{type:"primary",onClick:w},{default:o(()=>[t(V,{class:"mr-2"},{default:o(()=>[t(L(A))]),_:1}),e[14]||(e[14]=d(" 搜索 ",-1))]),_:1}),t(c,{onClick:I},{default:o(()=>[t(V,{class:"mr-2"},{default:o(()=>[t(L(ye))]),_:1}),e[15]||(e[15]=d(" 重置 ",-1))]),_:1})])]),m.value.length>0?(k(),z("div",Ve,[n("div",Ce,[n("span",ze," 已选择 "+v(m.value.length)+" 个友链 ",1),n("div",Le,[t(c,{size:"small",type:"danger",onClick:G},{default:o(()=>[...e[16]||(e[16]=[d("批量删除",-1)])]),_:1})])])])):j("",!0),n("div",Ue,[ge((k(),_e(le,{data:D.value,onSelectionChange:P,"row-key":"id",stripe:""},{default:o(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"网站名称","min-width":"120"},{default:o(({row:l})=>[n("div",Se,[l.avatar?(k(),z("img",{key:0,src:l.avatar,alt:l.name,class:"w-8 h-8 rounded-full object-cover",onError:ee},null,40,Be)):j("",!0),n("div",null,[n("div",je,v(l.name),1),n("div",De,v(l.url),1)])])]),_:1}),t(f,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(f,{prop:"sort",label:"排序",width:"80",align:"center"}),t(f,{prop:"status",label:"状态",width:"100",align:"center"},{default:o(({row:l})=>[t(ae,{type:l.status===0?"success":"warning",size:"small"},{default:o(()=>[d(v(l.status===0?"正常":"审核中"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createTime",label:"创建时间",width:"160"},{default:o(({row:l})=>[d(v(q(l.createTime)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[n("div",Te,[t(c,{size:"small",onClick:M=>H(l)},{default:o(()=>[...e[17]||(e[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:l.status===0?"warning":"success",onClick:M=>W(l)},{default:o(()=>[d(v(l.status===0?"审核":"通过"),1)]),_:2},1032,["type","onClick"]),t(c,{size:"small",type:"danger",onClick:M=>X(l)},{default:o(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ue,U.value]]),n("div",$e,[t(oe,{"current-page":u.page,"onUpdate:currentPage":e[3]||(e[3]=l=>u.page=l),"page-size":u.size,"onUpdate:pageSize":e[4]||(e[4]=l=>u.size=l),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),t(de,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),title:b.value?"编辑友链":"添加友链",width:"600px",onClose:J},{footer:o(()=>[n("div",Ne,[t(c,{onClick:e[10]||(e[10]=l=>y.value=!1)},{default:o(()=>[...e[22]||(e[22]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:Q,loading:S.value},{default:o(()=>[d(v(b.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:o(()=>[t(ie,{ref_key:"formRef",ref:T,model:s,rules:R,"label-width":"100px"},{default:o(()=>[t(x,{label:"网站名称",prop:"name"},{default:o(()=>[t(C,{modelValue:s.name,"onUpdate:modelValue":e[5]||(e[5]=l=>s.name=l),placeholder:"请输入网站名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"网站描述",prop:"description"},{default:o(()=>[t(C,{modelValue:s.description,"onUpdate:modelValue":e[6]||(e[6]=l=>s.description=l),type:"textarea",rows:3,placeholder:"请输入网站描述"},null,8,["modelValue"])]),_:1}),t(x,{label:"网站地址",prop:"url"},{default:o(()=>[t(C,{modelValue:s.url,"onUpdate:modelValue":e[7]||(e[7]=l=>s.url=l),placeholder:"请输入网站地址"},null,8,["modelValue"])]),_:1}),t(x,{label:"头像",prop:"avatar"},{default:o(()=>[n("div",Ee,[s.avatar?(k(),z("img",{key:0,src:s.avatar,alt:"头像预览",class:"w-16 h-16 rounded-full object-cover border"},null,8,Me)):j("",!0),t(se,{action:Ae,headers:F,"show-file-list":!1,"on-success":Y,"on-error":Z,accept:"image/*"},{default:o(()=>[t(c,{type:"primary",plain:""},{default:o(()=>[...e[19]||(e[19]=[d("上传头像",-1)])]),_:1})]),_:1})])]),_:1}),t(x,{label:"排序",prop:"sort"},{default:o(()=>[t(ne,{modelValue:s.sort,"onUpdate:modelValue":e[8]||(e[8]=l=>s.sort=l),min:0,max:9999},null,8,["modelValue"])]),_:1}),t(x,{label:"状态",prop:"status"},{default:o(()=>[t(re,{modelValue:s.status,"onUpdate:modelValue":e[9]||(e[9]=l=>s.status=l)},{default:o(()=>[t(E,{label:0},{default:o(()=>[...e[20]||(e[20]=[d("正常",-1)])]),_:1}),t(E,{label:1},{default:o(()=>[...e[21]||(e[21]=[d("审核中",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Oe=be(Re,[["__scopeId","data-v-12469c5c"]]);export{Oe as default};
