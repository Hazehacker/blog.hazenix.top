import{i as N,r as d,l as F,c as B,J as j,o as S,b as o,e as f,C as J,a as i,w as u,d as M,t as K,D as Z,N as Q,K as m,z as W,u as X,O as Y}from"./index-cinz6B6s.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";let G=!1,x=null;function ee(){return G?Promise.resolve():x||(x=new Promise((v,h)=>{const a=document.createElement("script");a.src="https://accounts.google.com/gsi/client",a.async=!0,a.defer=!0,a.onload=()=>{G=!0,v()},a.onerror=()=>h(new Error("Google Identity Services 腳本載入失敗")),document.head.appendChild(a)}),x)}async function oe({clientId:v,useOneTap:h=!1}){if(!v)throw new Error("缺少 Google Client ID（VITE_GOOGLE_CLIENT_ID）");return await ee(),new Promise((a,w)=>{try{window.google.accounts.id.initialize({client_id:v,auto_select:!1,callback:l=>{l&&l.credential?a(l.credential):w(new Error("未取得 Google id_token"))}}),h&&window.google.accounts.id.prompt(),window.google.accounts.id.prompt(l=>{}),window.google.accounts.id.renderButton?.(document.createElement("div"),{type:"standard",theme:"outline",size:"large",text:"signin_with",shape:"rectangular"}),window.google.accounts.id.prompt()}catch(l){w(l)}})}const te={class:"login-card"},se={key:0,class:"login-method-selection"},ae={class:"social-login-buttons"},le=["disabled"],re=["disabled"],ne={key:1,class:"email-login-form"},ie={class:"captcha-container"},ce={class:"captcha-text"},de={__name:"LoginDialog",setup(v,{expose:h}){const a=X(),w=W(),l=N(),_=d(),E=d(!1),k=d(!1),C=d(!1),L=d(!1),b=d(!1),T=d(""),r=d({email:"",password:"",captcha:""}),U={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},V=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let t=0;t<5;t++)e+=s.charAt(Math.floor(Math.random()*s.length));T.value=e},z=()=>{V()},H=()=>{b.value=!0,V()},O=()=>{b.value=!1},I=()=>{const s=document.getElementById("el-message-container");if(s&&(s.style.zIndex="10000000"),document.querySelectorAll(".el-message").forEach(t=>{t instanceof HTMLElement&&(t.style.zIndex="10000000")}),Y(()=>{const t=document.getElementById("el-message-container");t&&(t.style.zIndex="10000000"),document.querySelectorAll(".el-message").forEach(c=>{c instanceof HTMLElement&&(c.style.zIndex="10000000")})}),!window.__messageObserver){const t=new MutationObserver(()=>{document.querySelectorAll(".el-message").forEach(g=>{g instanceof HTMLElement&&(g.style.zIndex="10000000")});const c=document.getElementById("el-message-container");c&&(c.style.zIndex="10000000")});t.observe(document.body,{childList:!0,subtree:!0}),window.__messageObserver=t}},D=()=>{L.value=!0,b.value=!1,document.body.style.overflow="hidden",I()},p=()=>{L.value=!1,b.value=!1,document.body.style.overflow="",window.__messageObserver&&(window.__messageObserver.disconnect(),delete window.__messageObserver),r.value={email:"",password:"",captcha:""},_.value&&_.value.resetFields()},q=()=>{p(),a.push("/register")},P=async()=>{try{if(await _.value.validate(),r.value.captcha.toLowerCase()!==T.value.toLowerCase()){m.error("验证码错误"),setTimeout(()=>{I()},10),z();return}E.value=!0;const s={email:r.value.email,password:r.value.password};await l.login(s);try{await l.getUserInfo()}catch{}m.success("登录成功"),p();const e=w?.query?.redirect;typeof e=="string"&&e?a.replace(e):a.replace("/home")}catch(s){s.message?m.error(s.message):m.error("登录失败"),setTimeout(()=>{I()},10),z()}finally{E.value=!1}},R=async()=>{if(!C.value)try{C.value=!0,sessionStorage.setItem("oauth_source","github");let e=(await Q()).data;try{const t=new URL(e);let n=t.searchParams.get("redirect_uri");if(n){const c=decodeURIComponent(n),g=new URL(c);g.searchParams.set("source","github"),t.searchParams.set("redirect_uri",g.toString()),e=t.toString()}else t.searchParams.set("redirect_uri",`${window.location.origin}/home?source=github`),e=t.toString()}catch{}window.location.href=e}catch(s){m.error("获取GitHub授权链接失败: "+(s.message||"未知错误")),C.value=!1,sessionStorage.removeItem("oauth_source")}},A=async()=>{if(!k.value)try{k.value=!0;const e=await oe({clientId:"1047676337641-r9pn89h2a5mra3flbg3ea22ig23sc4rj.apps.googleusercontent.com",useOneTap:!1});await l.googleLoginByIdToken(e);try{await l.getUserInfo()}catch{}m.success("登录成功"),p();const t=w?.query?.redirect;typeof t=="string"&&t?a.replace(t):a.replace("/home")}catch(s){m.error(s?.message||"Google 登录失败"),setTimeout(()=>I(),10)}finally{k.value=!1}};return F(()=>{V()}),h({open:D,close:p}),(s,e)=>{const t=M("el-input"),n=M("el-form-item"),c=M("el-button"),g=M("el-form");return L.value?(S(),B("div",{key:0,class:"login-dialog-overlay",onClick:p},[o("div",{class:"login-dialog-container",onClick:e[3]||(e[3]=Z(()=>{},["stop"]))},[o("div",te,[o("button",{onClick:p,class:"close-btn"},[...e[4]||(e[4]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),e[16]||(e[16]=o("div",{class:"login-header"},[o("h1",{class:"login-title"},"登录到 Hazenix's Blog "),o("p",{class:"login-subtitle"},"欢迎回来! 请登录您的账号")],-1)),b.value?(S(),B("div",ne,[o("button",{onClick:O,class:"back-btn"},[...e[9]||(e[9]=[o("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),f(" 返回 ",-1)])]),i(g,{model:r.value,rules:U,ref_key:"formRef",ref:_,class:"login-form"},{default:u(()=>[i(n,{prop:"email"},{default:u(()=>[e[10]||(e[10]=o("label",{class:"form-label"},"邮箱",-1)),i(t,{modelValue:r.value.email,"onUpdate:modelValue":e[0]||(e[0]=y=>r.value.email=y),placeholder:"your@email.com",class:"form-input"},null,8,["modelValue"])]),_:1}),i(n,{prop:"password"},{default:u(()=>[e[11]||(e[11]=o("label",{class:"form-label"},"密码",-1)),i(t,{modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=y=>r.value.password=y),type:"password",placeholder:"........",class:"form-input"},null,8,["modelValue"])]),_:1}),i(n,{prop:"captcha"},{default:u(()=>[e[12]||(e[12]=o("label",{class:"form-label"},"验证码",-1)),o("div",ie,[i(t,{modelValue:r.value.captcha,"onUpdate:modelValue":e[2]||(e[2]=y=>r.value.captcha=y),placeholder:"输入验证码",class:"captcha-input"},null,8,["modelValue"]),o("div",{class:"captcha-image",onClick:z},[o("span",ce,K(T.value),1)])])]),_:1}),e[15]||(e[15]=o("div",{class:"forgot-password"},[o("a",{href:"#",class:"forgot-link"},[f("忘记密码? "),o("span",{class:"underline"},"点击这里重置")])],-1)),i(n,null,{default:u(()=>[i(c,{type:"primary",class:"login-btn",onClick:P,loading:E.value},{default:u(()=>[...e[13]||(e[13]=[f(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1}),i(n,null,{default:u(()=>[i(c,{class:"register-btn",onClick:q},{default:u(()=>[...e[14]||(e[14]=[f(" 没有账号? 注册 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):(S(),B("div",se,[o("button",{class:"email-login-btn",onClick:H},[...e[5]||(e[5]=[o("svg",{class:"email-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})],-1),f(" 通过邮箱 登录 ",-1)])]),e[8]||(e[8]=o("div",{class:"divider"},[o("span",{class:"divider-text"},"或通过社交账号登录")],-1)),o("div",ae,[o("button",{class:"github-login-btn",onClick:R,disabled:C.value},[...e[6]||(e[6]=[o("svg",{class:"github-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[o("path",{fill:"currentColor",d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})],-1),f(" GitHub ",-1)])],8,le),o("button",{class:"google-login-btn",onClick:A,disabled:k.value},[...e[7]||(e[7]=[J('<svg class="google-icon" viewBox="0 0 24 24" width="20" height="20" data-v-ba5c446b><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-ba5c446b></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-ba5c446b></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-ba5c446b></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-ba5c446b></path></svg> Google ',2)])],8,re)])]))])])])):j("",!0)}}},me=$(de,[["__scopeId","data-v-ba5c446b"]]);export{me as L};
