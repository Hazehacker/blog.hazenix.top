import{r as k,l as D,A as I,c as n,o as l,B as j,b as s,J as u,I as R,a as o,t as d,w as r,d as _,F as S,n as F,M as f,K as c,u as U,e as M,g as H,h as g,S as J,a0 as K,a1 as O}from"./index-cinz6B6s.js";import{d as W,i as q,e as G,l as P}from"./article-DZlkEKLi.js";import{A as Q,M as X,T as Y,C as Z}from"./TableOfContents-DkJ1LkMJ.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./helpers-YoB15h0M.js";import"./avatar-Br5af8Id.js";const te={class:"message-board"},ae={class:"article-container"},se={class:"article-main"},oe={key:0,class:"article-content"},le={class:"article-header"},ne={class:"article-title"},ie={key:0,class:"article-summary"},ce={class:"summary-content"},re={class:"article-body"},ue={key:1,class:"empty-state"},de={class:"article-sidebar"},ve={key:0,class:"sidebar-section"},me={key:1,class:"sidebar-section"},_e={class:"tag-cloud"},fe={class:"comments-section"},he={key:0,class:"fixed-actions"},pe={class:"action-text"},ye={class:"action-text"},ke={__name:"MessageBoard",setup(ge){const C=U(),e=k(null),v=k(!1),h=k(!1),p=()=>{h.value=window.innerWidth<768},T=t=>t.categoryName?t.categoryName:t.category&&t.category.name?t.category.name:"",w=t=>typeof t=="object"&&t!==null?t.name:t,b=async()=>{v.value=!0;try{const t=await W(1);if(t&&t.data){e.value=t.data;try{await q(1)}catch{}}else throw new Error("留言板内容为空")}catch(t){let a="加载留言板失败";t.response&&(t.response.status===404?a="留言板内容不存在，请先创建 id=1 的文章":t.response.status===500?a="服务器内部错误，请稍后重试":a=`请求失败 (${t.response.status})`),c.error(a)}finally{v.value=!1}},x=async()=>{if(e.value)try{await P(1),e.value.isLiked=!e.value.isLiked;const t=e.value.likeCount||e.value.likes||0;e.value.likeCount=t+(e.value.isLiked?1:-1),e.value.likes=e.value.likeCount,c.success(e.value.isLiked?"点赞成功":"取消点赞")}catch{c.error("操作失败")}},A=async()=>{if(e.value)try{navigator.share?await navigator.share({title:e.value.title,text:e.value.summary||"",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),c.success("链接已复制到剪贴板"))}catch{c.error("分享失败")}},L=async()=>{if(e.value)try{await G(1),e.value.isCollected=!e.value.isCollected,c.success(e.value.isCollected?"收藏成功":"取消收藏")}catch{c.error("操作失败")}},B=t=>{},E=t=>{e.value&&(e.value.commentCount=(e.value.commentCount||0)+1)},N=t=>{const a=e.value?.tags?.find(i=>typeof i=="object"&&i!==null?i.name===t:i===t);if(a){const i=typeof a=="object"?a.id:a;C.push(`/tag/${i}`)}else C.push(`/articles?tag=${encodeURIComponent(t)}`)};return D(()=>{p(),window.addEventListener("resize",p),b()}),I(()=>{window.removeEventListener("resize",p)}),(t,a)=>{const i=_("el-button"),$=_("el-empty"),z=_("el-tag"),y=_("el-icon"),V=R("loading");return l(),n("div",te,[j((l(),n("div",ae,[s("main",se,[e.value?(l(),n("article",oe,[s("header",le,[s("h1",ne,d(e.value.title),1),o(Q,{"author-name":"Hazenix","created-at":e.value.createTime||e.value.createdAt,"updated-at":e.value.updatedAt||e.value.updateTime,content:e.value.content,views:e.value.viewCount||e.value.views||0,"category-name":T(e.value),tags:e.value.tags},null,8,["created-at","updated-at","content","views","category-name","tags"])]),e.value.summary?(l(),n("div",ie,[s("div",ce,d(e.value.summary),1)])):u("",!0),s("div",re,[o(X,{content:e.value.content},null,8,["content"])])])):v.value?u("",!0):(l(),n("div",ue,[o($,{description:"留言板内容加载中..."},{default:r(()=>[o(i,{type:"primary",onClick:b},{default:r(()=>[...a[0]||(a[0]=[M(" 重新加载 ",-1)])]),_:1})]),_:1})]))]),s("aside",de,[e.value?.content?(l(),n("div",ve,[o(Y,{content:e.value.content,"is-mobile":h.value,article:e.value,onTocClick:B,onLike:x,onCollect:L,onShare:A},null,8,["content","is-mobile","article"])])):u("",!0),e.value?.tags&&e.value.tags.length>0?(l(),n("div",me,[a[1]||(a[1]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},"标签")],-1)),s("div",_e,[(l(!0),n(S,null,F(e.value.tags,m=>(l(),H(z,{key:m.id||m,size:"small",class:"tag-item",onClick:Ce=>N(w(m))},{default:r(()=>[M(d(w(m)),1)]),_:2},1032,["onClick"]))),128))])])):u("",!0)])])),[[V,v.value]]),s("div",fe,[o(Z,{"article-id":1,onCommentAdded:E})]),e.value&&!h.value?(l(),n("div",he,[s("div",{class:f(["action-item",{liked:e.value?.isLiked}]),onClick:x},[o(y,{class:f(["action-icon",{"text-yellow-500":e.value?.isLiked}])},{default:r(()=>[o(g(J))]),_:1},8,["class"]),s("span",pe,d(e.value?.likeCount||e.value?.likes||0),1)],2),s("div",{class:f(["action-item",{collected:e.value?.isCollected}]),onClick:L},[o(y,{class:f(["action-icon",{"text-green-500":e.value?.isCollected}])},{default:r(()=>[o(g(K))]),_:1},8,["class"]),s("span",ye,d(e.value?.isCollected?"已收藏":"收藏"),1)],2),s("div",{class:"action-item",onClick:A},[o(y,{class:"action-icon"},{default:r(()=>[o(g(O))]),_:1}),a[2]||(a[2]=s("span",{class:"action-text"},"分享",-1))])])):u("",!0)])}}},Te=ee(ke,[["__scopeId","data-v-7b80ca8e"]]);export{Te as default};
