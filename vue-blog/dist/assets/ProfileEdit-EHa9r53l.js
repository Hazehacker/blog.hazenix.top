import{i as I,r as i,W as M,j as V,c as u,o as g,b as e,a as _,K as j,y as n,ae as f,aq as S,D as x,E as o,u as B}from"./index-BBqYyNLz.js";import{_ as C}from"./LoadingSpinner-BDhi2Jtp.js";import{u as D,b as E,c as R}from"./user-S9uowIP7.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"profile-edit"},N={class:"container mx-auto px-4 py-8"},$={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6"},G={key:0,class:"flex justify-center py-8"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W={class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-6"},q={class:"flex items-center space-x-4"},A={class:"flex-shrink-0"},J={class:"w-20 h-20 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-700"},K=["src"],T={key:1,class:"w-full h-full flex items-center justify-center text-gray-400 dark:text-gray-500"},H={class:"flex-1"},O=["disabled"],Q={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},X={class:"flex justify-end space-x-4"},Y=["disabled"],Z={__name:"ProfileEdit",setup(rr){const w=B(),m=I(),p=i(!0),b=i(!1),c=i(!1),l=i(""),y=i(null),a=M({username:"",email:"",gender:0,avatar:"",currentPassword:"",newPassword:"",confirmPassword:""}),v=async()=>{try{await m.getUserInfo();const t=m.userInfo||{};a.username=t.username||"",a.email=t.email||"",a.gender=t.gender??0,a.avatar=t.avatar||"",l.value=""}catch(t){console.error("获取用户信息失败:",t),o.error("获取用户信息失败")}finally{p.value=!1}},k=()=>{y.value?.click()},P=async t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/")){o.error("只能上传图片文件");return}if(r.size>5*1024*1024){o.error("图片大小不能超过 5MB");return}const s=new FileReader;s.onload=d=>{l.value=d.target.result},s.readAsDataURL(r),c.value=!0;try{const d=await D(r);d.code===200?(a.avatar=d.data,o.success("头像上传成功")):(o.error(d.msg||"头像上传失败"),l.value="")}catch(d){console.error("头像上传失败:",d),o.error("头像上传失败，请重试"),l.value=""}finally{c.value=!1,y.value&&(y.value.value="")}},h=()=>{if(a.currentPassword||a.newPassword||a.confirmPassword){if(!a.currentPassword)return o.error("请输入当前密码"),!1;if(!a.newPassword)return o.error("请输入新密码"),!1;if(a.newPassword.length<6)return o.error("新密码长度不能少于6位"),!1;if(a.newPassword!==a.confirmPassword)return o.error("两次输入的密码不一致"),!1}return!0},U=async()=>{if(h()){b.value=!0;try{const t={username:a.username,gender:a.gender,avatar:a.avatar};await E(t),a.currentPassword&&a.newPassword&&await R({currentPassword:a.currentPassword,newPassword:a.newPassword}),await m.getUserInfo(),o.success("资料更新成功"),w.push("/profile")}catch(t){console.error("更新资料失败:",t),o.error(t.response?.data?.msg||t.message||"更新资料失败，请重试")}finally{b.value=!1}}};return V(()=>{v()}),(t,r)=>(g(),u("div",z,[e("div",N,[e("div",$,[r[19]||(r[19]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-6"}," 编辑资料 ",-1)),p.value?(g(),u("div",G,[_(C)])):(g(),u("form",{key:1,onSubmit:j(U,["prevent"]),class:"space-y-6"},[e("div",null,[r[14]||(r[14]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 基本信息 ",-1)),e("div",L,[e("div",null,[r[7]||(r[7]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 昵称 ",-1)),n(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>a.username=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"请输入昵称"},null,512),[[f,a.username]])]),e("div",null,[r[8]||(r[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 邮箱 ",-1)),n(e("input",{"onUpdate:modelValue":r[1]||(r[1]=s=>a.email=s),type:"email",readonly:"",disabled:"",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 cursor-not-allowed text-gray-500 dark:text-gray-400",placeholder:"请输入邮箱"},null,512),[[f,a.email]])])]),e("div",W,[e("div",null,[r[10]||(r[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"性别",-1)),n(e("select",{"onUpdate:modelValue":r[2]||(r[2]=s=>a.gender=s),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"},[...r[9]||(r[9]=[e("option",{value:0},"保密",-1),e("option",{value:1},"男",-1),e("option",{value:2},"女",-1)])],512),[[S,a.gender]])]),e("div",null,[r[13]||(r[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"头像",-1)),e("div",q,[e("div",A,[e("div",J,[l.value||a.avatar?(g(),u("img",{key:0,src:l.value||a.avatar,alt:"",class:"w-full h-full object-cover"},null,8,K)):(g(),u("div",T,[...r[11]||(r[11]=[e("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)])]))])]),e("div",H,[e("input",{ref_key:"fileInputRef",ref:y,type:"file",accept:"image/*",onChange:P,class:"hidden"},null,544),e("button",{type:"button",onClick:k,disabled:c.value,class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},x(c.value?"上传中...":"选择头像"),9,O),r[12]||(r[12]=e("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 支持 JPG、PNG 格式，建议尺寸 200x200 像素 ",-1))])])])])]),e("div",null,[r[18]||(r[18]=e("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"}," 密码修改 ",-1)),e("div",Q,[e("div",null,[r[15]||(r[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 当前密码 ",-1)),n(e("input",{"onUpdate:modelValue":r[3]||(r[3]=s=>a.currentPassword=s),type:"password",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"请输入当前密码"},null,512),[[f,a.currentPassword]])]),e("div",null,[r[16]||(r[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 新密码 ",-1)),n(e("input",{"onUpdate:modelValue":r[4]||(r[4]=s=>a.newPassword=s),type:"password",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"请输入新密码"},null,512),[[f,a.newPassword]])]),e("div",null,[r[17]||(r[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 确认新密码 ",-1)),n(e("input",{"onUpdate:modelValue":r[5]||(r[5]=s=>a.confirmPassword=s),type:"password",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"请确认新密码"},null,512),[[f,a.confirmPassword]])])])]),e("div",X,[e("button",{type:"button",onClick:r[6]||(r[6]=s=>t.$router.go(-1)),class:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"}," 取消 "),e("button",{type:"submit",disabled:b.value,class:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},x(b.value?"保存中...":"保存修改"),9,Y)])],32))])])]))}},or=F(Z,[["__scopeId","data-v-cd93dc0e"]]);export{or as default};
