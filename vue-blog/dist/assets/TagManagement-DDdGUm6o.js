import{r as m,S as B,K as de,o as ue,c as ce,f as r,e as t,l as a,j as n,C as pe,B as me,A as ge,k as fe,G as _,H as u,b as N,q as i,n as C,a3 as _e,y as R,T as ve,J as ye,a8 as K}from"./index-BjRrW_j8.js";import{a as b}from"./admin-C4GflvBV.js";const be={class:"space-y-6"},xe={class:"flex justify-between items-center"},he={class:"flex space-x-3"},we={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},Ve={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ke={class:"flex space-x-2"},Ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},Te={class:"flex items-center"},ze={class:"text-gray-600 dark:text-gray-400"},Se={class:"flex space-x-2"},Be={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},Ue={class:"text-sm text-gray-500 dark:text-gray-400"},De={class:"flex items-center space-x-3"},je={class:"flex justify-end space-x-3"},qe={__name:"TagManagement",setup($e){const T=m(!1),z=m(!1),U=m([]),w=m([]),S=m(0),x=m(),v=B({keyword:"",status:""}),d=B({page:1,pageSize:20}),y=m(!1),g=m(null),O=de(()=>g.value?"编辑标签":"新建标签"),s=B({name:"",slug:"",color:"#3B82F6",sort:0,status:0}),A={name:[{required:!0,message:"请输入标签名称",trigger:"blur"},{min:1,max:20,message:"标签名称长度在 1 到 20 个字符",trigger:"blur"}],color:[{required:!0,message:"请选择标签颜色",trigger:"change"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},L=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=async()=>{T.value=!0;try{const o={page:d.page,pageSize:d.pageSize,...v},e=await b.getTags(o);U.value=e.data.records,S.value=e.data.total}catch(o){console.error("加载标签列表失败:",o),u.error("加载标签列表失败")}finally{T.value=!1}},D=()=>{d.page=1,c()},G=()=>{Object.assign(v,{keyword:"",status:""}),d.page=1,c()},H=o=>{d.pageSize=o,d.page=1,c()},J=o=>{d.page=o,c()},P=o=>{w.value=o},I=()=>{g.value=null,j(),y.value=!0},Q=o=>{g.value={...o},Object.assign(s,{name:o.name,slug:o.slug||"",color:o.color||"#3B82F6",sort:o.sort||0,status:o.status||0}),y.value=!0},W=async o=>{try{const e=o.status===0?1:0;await b.updateTag(o.id,{status:e}),u.success(`${e===0?"启用":"禁用"} 成功`),c()}catch(e){console.error("切换标签状态失败:",e),u.error("操作失败")}},X=async o=>{try{await K.confirm(`确定要删除标签"${o.name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.deleteTag(o.id),u.success("删除成功"),c()}catch(e){e!=="cancel"&&(console.error("删除标签失败:",e),u.error("删除失败"))}},Y=async()=>{try{await K.confirm(`确定要删除选中的 ${w.value.length} 个标签吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=w.value.map(e=>e.id);await b.batchDeleteTags(o),u.success("批量删除成功"),c()}catch(o){o!=="cancel"&&(console.error("批量删除失败:",o),u.error("批量删除失败"))}},Z=async()=>{if(x.value)try{await x.value.validate(),z.value=!0,g.value?(await b.updateTag(g.value.id,s),u.success("更新成功")):(await b.createTag(s),u.success("创建成功")),y.value=!1,c()}catch(o){o!==!1&&(console.error("保存标签失败:",o),u.error("保存失败"))}finally{z.value=!1}},j=()=>{Object.assign(s,{name:"",slug:"",color:"#3B82F6",sort:0,status:0}),x.value&&x.value.clearValidate()},$=()=>{y.value=!1,g.value=null,j()};return ue(()=>{c()}),(o,e)=>{const p=n("el-button"),V=n("el-icon"),k=n("el-input"),F=n("el-option"),ee=n("el-select"),f=n("el-table-column"),M=n("el-tag"),te=n("el-table"),le=n("el-pagination"),h=n("el-form-item"),ae=n("el-color-picker"),oe=n("el-input-number"),q=n("el-radio"),se=n("el-radio-group"),ne=n("el-form"),re=n("el-dialog"),ie=ge("loading");return N(),ce("div",be,[r("div",xe,[e[14]||(e[14]=r("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"标签管理",-1)),r("div",he,[t(p,{onClick:Y,type:"danger",disabled:w.value.length===0},{default:a(()=>[...e[12]||(e[12]=[i(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(p,{onClick:I,type:"primary"},{default:a(()=>[t(V,{class:"mr-1"},{default:a(()=>[t(C(_e))]),_:1}),e[13]||(e[13]=i(" 新建标签 ",-1))]),_:1})])]),r("div",we,[r("div",Ve,[t(k,{modelValue:v.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>v.keyword=l),placeholder:"搜索标签名称或描述",clearable:"",onKeyup:pe(D,["enter"])},{prefix:a(()=>[t(V,null,{default:a(()=>[t(C(R))]),_:1})]),_:1},8,["modelValue"]),t(ee,{modelValue:v.status,"onUpdate:modelValue":e[1]||(e[1]=l=>v.status=l),placeholder:"选择状态",clearable:""},{default:a(()=>[t(F,{label:"启用",value:"0"}),t(F,{label:"禁用",value:"1"})]),_:1},8,["modelValue"]),r("div",ke,[t(p,{onClick:D,type:"primary"},{default:a(()=>[t(V,{class:"mr-1"},{default:a(()=>[t(C(R))]),_:1}),e[15]||(e[15]=i(" 搜索 ",-1))]),_:1}),t(p,{onClick:G},{default:a(()=>[t(V,{class:"mr-1"},{default:a(()=>[t(C(ve))]),_:1}),e[16]||(e[16]=i(" 重置 ",-1))]),_:1})])])]),r("div",Ce,[me((N(),fe(te,{data:U.value,onSelectionChange:P,"row-key":"id"},{default:a(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"name",label:"标签名称","min-width":"150"},{default:a(({row:l})=>[r("div",Te,[t(M,{color:l.color,type:l.color?"":"primary",size:"small",class:"mr-2"},{default:a(()=>[i(_(l.name),1)]),_:2},1032,["color","type"])])]),_:1}),t(f,{prop:"slug",label:"URL标识符","min-width":"200"},{default:a(({row:l})=>[r("span",ze,_(l.slug||"-"),1)]),_:1}),t(f,{prop:"sort",label:"排序",width:"100"}),t(f,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(M,{type:l.status===0?"success":"danger",size:"small"},{default:a(()=>[i(_(l.status===0?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createTime",label:"创建时间",width:"180"},{default:a(({row:l})=>[i(_(L(l.createTime)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[r("div",Se,[t(p,{onClick:E=>Q(l),size:"small"},{default:a(()=>[...e[17]||(e[17]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(p,{onClick:E=>W(l),size:"small",type:l.status===0?"warning":"success"},{default:a(()=>[i(_(l.status===0?"禁用":"启用"),1)]),_:2},1032,["onClick","type"]),t(p,{onClick:E=>X(l),size:"small",type:"danger",plain:""},{default:a(()=>[...e[18]||(e[18]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ie,T.value]]),r("div",Be,[r("div",Ue," 共 "+_(S.value)+" 条记录 ",1),t(le,{"current-page":d.page,"onUpdate:currentPage":e[2]||(e[2]=l=>d.page=l),"page-size":d.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>d.pageSize=l),"page-sizes":[10,20,50,100],total:S.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),t(re,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),title:O.value,width:"500px","close-on-click-modal":!1,onClose:$},{footer:a(()=>[r("div",je,[t(p,{onClick:$},{default:a(()=>[...e[21]||(e[21]=[i("取消",-1)])]),_:1}),t(p,{onClick:Z,type:"primary",loading:z.value},{default:a(()=>[i(_(g.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(ne,{ref_key:"formRef",ref:x,model:s,rules:A,"label-width":"80px",onSubmit:e[10]||(e[10]=ye(()=>{},["prevent"]))},{default:a(()=>[t(h,{label:"标签名称",prop:"name"},{default:a(()=>[t(k,{modelValue:s.name,"onUpdate:modelValue":e[4]||(e[4]=l=>s.name=l),placeholder:"请输入标签名称",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(h,{label:"slug",prop:"slug"},{default:a(()=>[t(k,{modelValue:s.slug,"onUpdate:modelValue":e[5]||(e[5]=l=>s.slug=l),type:"textarea",rows:3,placeholder:"请输入标签描述",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(h,{label:"标签颜色",prop:"color"},{default:a(()=>[r("div",De,[t(ae,{modelValue:s.color,"onUpdate:modelValue":e[6]||(e[6]=l=>s.color=l)},null,8,["modelValue"]),t(k,{modelValue:s.color,"onUpdate:modelValue":e[7]||(e[7]=l=>s.color=l),placeholder:"#000000",maxlength:"7",style:{width:"120px"}},null,8,["modelValue"])])]),_:1}),t(h,{label:"排序",prop:"sort"},{default:a(()=>[t(oe,{modelValue:s.sort,"onUpdate:modelValue":e[8]||(e[8]=l=>s.sort=l),min:0,max:9999,"controls-position":"right",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(h,{label:"状态",prop:"status"},{default:a(()=>[t(se,{modelValue:s.status,"onUpdate:modelValue":e[9]||(e[9]=l=>s.status=l)},{default:a(()=>[t(q,{value:"0"},{default:a(()=>[...e[19]||(e[19]=[i("启用",-1)])]),_:1}),t(q,{value:"1"},{default:a(()=>[...e[20]||(e[20]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{qe as default};
