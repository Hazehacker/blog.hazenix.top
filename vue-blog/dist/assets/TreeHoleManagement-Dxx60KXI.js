import{r as _,X as j,l as Q,c as U,o as T,b as a,a as t,w as o,d as u,H as N,B as W,I as Z,g as ee,t as d,K as f,aj as $,e as c,h as k,x as K,y as te,Y as ae,J as se}from"./index-Cr_Or7lo.js";import{a as V}from"./admin-DOO57u4q.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"space-y-6"},ne={class:"flex justify-between items-center"},re={class:"flex space-x-3"},de={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ue={class:"flex space-x-2"},ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},pe={class:"font-medium text-gray-900 dark:text-gray-100"},ge={class:"max-w-xs"},me={class:"text-gray-900 dark:text-gray-100 line-clamp-2"},ye={class:"flex space-x-2"},_e={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},fe={class:"text-sm text-gray-500 dark:text-gray-400"},ve={key:0,class:"space-y-4"},xe={class:"flex items-center space-x-3 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"},be={class:"font-medium text-gray-900 dark:text-gray-100"},ke={class:"text-sm text-gray-500 dark:text-gray-400"},he={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},we={class:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Ce={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},ze={class:"grid grid-cols-2 gap-4 text-sm"},Te={class:"ml-2 text-gray-700 dark:text-gray-300"},Ve={class:"col-span-2"},Se={class:"ml-2 text-gray-700 dark:text-gray-300"},De={class:"flex justify-end space-x-3"},Be={__name:"TreeHoleManagement",setup(He){const h=_(!1),w=_([]),v=_([]),x=_(0),n=j({keyword:"",username:"",status:void 0}),r=j({page:1,pageSize:20}),y=_(!1),i=_(null),S=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",D=s=>({0:"success",1:"danger"})[s]||"info",B=s=>({0:"正常",1:"已刪除"})[s]||"未知",g=async()=>{h.value=!0;try{const s={page:r.page,pageSize:r.pageSize};n.keyword&&(s.keyword=n.keyword),n.username&&(s.username=n.username),n.status!==void 0&&n.status!==null&&n.status!==""&&(s.status=n.status);const e=await V.getTreeHoles(s);e.data&&e.data.records?(w.value=e.data.records,x.value=e.data.total||0):(w.value=e.data?.list||e.data||[],x.value=e.data?.total||0)}catch(s){console.error("加載樹洞列表失敗:",s),f.error("加載樹洞列表失敗")}finally{h.value=!1}},C=()=>{r.page=1,g()},E=()=>{Object.assign(n,{keyword:"",username:"",status:void 0}),r.page=1,g()},A=s=>{r.pageSize=s,r.page=1,g()},F=s=>{r.page=s,g()},J=s=>{v.value=s},L=s=>{i.value=s,y.value=!0},H=async s=>{try{await $.confirm("確定要刪除這條樹洞嗎？此操作不可恢復。","確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),await V.deleteTreeHole(s.id),f.success("刪除成功"),g(),y.value&&(y.value=!1)}catch(e){e!=="cancel"&&(console.error("刪除樹洞失敗:",e),f.error("刪除失敗"))}},O=async()=>{try{await $.confirm(`確定要刪除選中的 ${v.value.length} 條樹洞嗎？此操作不可恢復。`,"確認批量刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"});const s=v.value.map(e=>e.id);await V.batchDeleteTreeHoles(s),f.success("批量刪除成功"),g()}catch(s){s!=="cancel"&&(console.error("批量刪除失敗:",s),f.error("批量刪除失敗"))}};return Q(()=>{g()}),(s,e)=>{const m=u("el-button"),b=u("el-icon"),M=u("el-input"),z=u("el-option"),P=u("el-select"),p=u("el-table-column"),I=u("el-tag"),R=u("el-table"),X=u("el-pagination"),Y=u("el-dialog"),q=Z("loading");return T(),U("div",oe,[a("div",ne,[e[9]||(e[9]=a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"樹洞管理",-1)),a("div",re,[t(m,{onClick:O,type:"danger",disabled:v.value.length===0},{default:o(()=>[...e[8]||(e[8]=[c(" 批量刪除 ",-1)])]),_:1},8,["disabled"])])]),a("div",de,[a("div",ie,[t(M,{modelValue:n.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>n.keyword=l),placeholder:"搜索樹洞內容",clearable:"",onKeyup:N(C,["enter"])},{prefix:o(()=>[t(b,null,{default:o(()=>[t(k(K))]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:n.username,"onUpdate:modelValue":e[1]||(e[1]=l=>n.username=l),placeholder:"搜索用戶名",clearable:"",onKeyup:N(C,["enter"])},{prefix:o(()=>[t(b,null,{default:o(()=>[t(k(te))]),_:1})]),_:1},8,["modelValue"]),t(P,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"選擇狀態",clearable:""},{default:o(()=>[t(z,{label:"全部",value:void 0}),t(z,{label:"正常",value:0}),t(z,{label:"已刪除",value:1})]),_:1},8,["modelValue"]),a("div",ue,[t(m,{onClick:C,type:"primary"},{default:o(()=>[t(b,{class:"mr-1"},{default:o(()=>[t(k(K))]),_:1}),e[10]||(e[10]=c(" 搜索 ",-1))]),_:1}),t(m,{onClick:E},{default:o(()=>[t(b,{class:"mr-1"},{default:o(()=>[t(k(ae))]),_:1}),e[11]||(e[11]=c(" 重置 ",-1))]),_:1})])])]),a("div",ce,[W((T(),ee(R,{data:w.value,onSelectionChange:J,"row-key":"id"},{default:o(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"id",label:"ID",width:"80"}),t(p,{prop:"userId",label:"用戶ID",width:"100"}),t(p,{prop:"username",label:"用戶名",width:"120"},{default:o(({row:l})=>[a("span",pe,d(l.username||"-"),1)]),_:1}),t(p,{prop:"content",label:"樹洞內容","min-width":"300"},{default:o(({row:l})=>[a("div",ge,[a("p",me,d(l.content),1)])]),_:1}),t(p,{prop:"status",label:"狀態",width:"100"},{default:o(({row:l})=>[t(I,{type:D(l.status),size:"small"},{default:o(()=>[c(d(B(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"createTime",label:"創建時間",width:"180"},{default:o(({row:l})=>[c(d(S(l.createTime)),1)]),_:1}),t(p,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[a("div",ye,[t(m,{onClick:G=>L(l),size:"small",type:"primary",plain:""},{default:o(()=>[...e[12]||(e[12]=[c(" 查看 ",-1)])]),_:1},8,["onClick"]),t(m,{onClick:G=>H(l),size:"small",type:"danger",plain:""},{default:o(()=>[...e[13]||(e[13]=[c(" 刪除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[q,h.value]]),a("div",_e,[a("div",fe," 共 "+d(x.value)+" 條記錄 ",1),t(X,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=l=>r.page=l),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>r.pageSize=l),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),t(Y,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),title:"樹洞詳情",width:"600px","close-on-click-modal":!1},{footer:o(()=>[a("div",De,[t(m,{onClick:e[5]||(e[5]=l=>y.value=!1)},{default:o(()=>[...e[19]||(e[19]=[c("關閉",-1)])]),_:1}),t(m,{onClick:e[6]||(e[6]=l=>H(i.value)),type:"danger"},{default:o(()=>[...e[20]||(e[20]=[c(" 刪除 ",-1)])]),_:1})])]),default:o(()=>[i.value?(T(),U("div",ve,[a("div",xe,[a("div",null,[a("h3",be,"用戶ID: "+d(i.value.userId),1),a("p",ke," 用戶名: "+d(i.value.username||"-"),1)])]),a("div",he,[e[14]||(e[14]=a("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"樹洞內容",-1)),a("p",we,d(i.value.content),1)]),a("div",Ce,[e[18]||(e[18]=a("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"其他信息",-1)),a("div",ze,[a("div",null,[e[15]||(e[15]=a("span",{class:"text-gray-500 dark:text-gray-400"},"ID:",-1)),a("span",Te,d(i.value.id),1)]),a("div",null,[e[16]||(e[16]=a("span",{class:"text-gray-500 dark:text-gray-400"},"狀態:",-1)),t(I,{type:D(i.value.status),size:"small",class:"ml-2"},{default:o(()=>[c(d(B(i.value.status)),1)]),_:1},8,["type"])]),a("div",Ve,[e[17]||(e[17]=a("span",{class:"text-gray-500 dark:text-gray-400"},"創建時間:",-1)),a("span",Se,d(S(i.value.createTime)),1)])])])])):se("",!0)]),_:1},8,["modelValue"])])}}},Ue=le(Be,[["__scopeId","data-v-58a0dcf8"]]);export{Ue as default};
