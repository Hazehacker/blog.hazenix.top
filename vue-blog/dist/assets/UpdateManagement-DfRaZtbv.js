import{r as f,S as Y,K as ge,o as ce,c as M,f as o,e as t,l as a,j as u,C as fe,B as ye,A as ve,k as $,G as d,H as v,b as x,q as r,n as T,a3 as _e,y as P,T as xe,J as be,D as q,a8 as Q}from"./index-BjRrW_j8.js";import{a as D}from"./admin-C4GflvBV.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"space-y-6"},he={class:"flex justify-between items-center"},Ve={class:"flex space-x-3"},Ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ze={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},De={class:"flex space-x-2"},Ue={class:"bg-white dark:bg-gray-800 rounded-lg shadow"},Se={class:"font-medium text-gray-900 dark:text-gray-100"},Me={class:"max-w-xs"},Te={class:"text-gray-900 dark:text-gray-100 line-clamp-2"},Be={key:1,class:"text-gray-400"},je={class:"flex space-x-2"},Ie={class:"flex justify-between items-center p-4 border-t border-gray-200 dark:border-gray-700"},Ye={class:"text-sm text-gray-500 dark:text-gray-400"},$e={class:"flex justify-end space-x-3"},qe={key:0,class:"space-y-4"},Ne={class:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"},Ee={class:"flex items-center space-x-3"},Ke={class:"font-medium text-gray-900 dark:text-gray-100"},Oe={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"flex items-center space-x-2"},Ae={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Fe={class:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Ge={key:0,class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},He=["href"],Je={class:"p-4 bg-white dark:bg-gray-800 rounded-lg border"},Le={class:"grid grid-cols-2 gap-4 text-sm"},Pe={class:"ml-2 text-gray-700 dark:text-gray-300"},Qe={class:"ml-2 text-gray-700 dark:text-gray-300"},We={class:"flex justify-end space-x-3"},Xe={__name:"UpdateManagement",setup(Ze){const B=f(!1),j=f(!1),N=f([]),U=f([]),I=f(0),V=f(),b=Y({keyword:"",type:""}),m=Y({page:1,pageSize:20}),k=f(!1),w=f(!1),n=f(null),W=ge(()=>n.value?"编辑更新记录":"新建更新记录"),i=Y({version:"",title:"",type:"",content:"",releaseDate:"",isImportant:!1,link:""}),X={version:[{required:!0,message:"请输入版本号",trigger:"blur"},{min:1,max:20,message:"版本号长度在 1 到 20 个字符",trigger:"blur"}],title:[{required:!0,message:"请输入更新标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择更新类型",trigger:"change"}],content:[{required:!0,message:"请输入更新内容",trigger:"blur"},{min:1,max:1e3,message:"内容长度在 1 到 1000 个字符",trigger:"blur"}],releaseDate:[{required:!0,message:"请选择发布日期",trigger:"change"}]},C=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"}),E=s=>({feature:"success",bugfix:"warning",optimization:"info",security:"danger",other:""})[s]||"",K=s=>({feature:"功能更新",bugfix:"问题修复",optimization:"性能优化",security:"安全更新",other:"其他"})[s]||"未知",y=async()=>{B.value=!0;try{const s={page:m.page,pageSize:m.pageSize,...b},e=await D.getUpdates(s);N.value=e.data.list,I.value=e.data.total}catch(s){console.error("加载更新记录列表失败:",s),v.error("加载更新记录列表失败")}finally{B.value=!1}},O=()=>{m.page=1,y()},Z=()=>{Object.assign(b,{keyword:"",type:""}),m.page=1,y()},ee=s=>{m.pageSize=s,m.page=1,y()},te=s=>{m.page=s,y()},le=s=>{U.value=s},ae=()=>{n.value=null,F(),k.value=!0},R=s=>{n.value={...s},Object.assign(i,{version:s.version,title:s.title,type:s.type,content:s.content,releaseDate:s.releaseDate,isImportant:s.isImportant||!1,link:s.link||""}),k.value=!0},se=s=>{n.value=s,w.value=!0},A=async s=>{try{await Q.confirm(`确定要删除更新记录"${s.title}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await D.deleteUpdate(s.id),v.success("删除成功"),y(),w.value&&(w.value=!1)}catch(e){e!=="cancel"&&(console.error("删除更新记录失败:",e),v.error("删除失败"))}},oe=async()=>{try{await Q.confirm(`确定要删除选中的 ${U.value.length} 条更新记录吗？此操作不可恢复。`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=U.value.map(e=>e.id);await D.batchDeleteUpdates(s),v.success("批量删除成功"),y()}catch(s){s!=="cancel"&&(console.error("批量删除失败:",s),v.error("批量删除失败"))}},ne=async()=>{if(V.value)try{await V.value.validate(),j.value=!0,n.value?(await D.updateUpdate(n.value.id,i),v.success("更新成功")):(await D.createUpdate(i),v.success("创建成功")),k.value=!1,y()}catch(s){s!==!1&&(console.error("保存更新记录失败:",s),v.error("保存失败"))}finally{j.value=!1}},F=()=>{Object.assign(i,{version:"",title:"",type:"",content:"",releaseDate:"",isImportant:!1,link:""}),V.value&&V.value.clearValidate()},G=()=>{k.value=!1,n.value=null,F()};return ce(()=>{y()}),(s,e)=>{const p=u("el-button"),S=u("el-icon"),z=u("el-input"),g=u("el-option"),H=u("el-select"),c=u("el-table-column"),h=u("el-tag"),re=u("el-table"),ie=u("el-pagination"),_=u("el-form-item"),de=u("el-date-picker"),ue=u("el-switch"),pe=u("el-form"),J=u("el-dialog"),me=ve("loading");return x(),M("div",we,[o("div",he,[e[19]||(e[19]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"更新记录管理",-1)),o("div",Ve,[t(p,{onClick:oe,type:"danger",disabled:U.value.length===0},{default:a(()=>[...e[17]||(e[17]=[r(" 批量删除 ",-1)])]),_:1},8,["disabled"]),t(p,{onClick:ae,type:"primary"},{default:a(()=>[t(S,{class:"mr-1"},{default:a(()=>[t(T(_e))]),_:1}),e[18]||(e[18]=r(" 新建记录 ",-1))]),_:1})])]),o("div",Ce,[o("div",ze,[t(z,{modelValue:b.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>b.keyword=l),placeholder:"搜索版本号或更新内容",clearable:"",onKeyup:fe(O,["enter"])},{prefix:a(()=>[t(S,null,{default:a(()=>[t(T(P))]),_:1})]),_:1},8,["modelValue"]),t(H,{modelValue:b.type,"onUpdate:modelValue":e[1]||(e[1]=l=>b.type=l),placeholder:"选择类型",clearable:""},{default:a(()=>[t(g,{label:"功能更新",value:"feature"}),t(g,{label:"问题修复",value:"bugfix"}),t(g,{label:"性能优化",value:"optimization"}),t(g,{label:"安全更新",value:"security"}),t(g,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),o("div",De,[t(p,{onClick:O,type:"primary"},{default:a(()=>[t(S,{class:"mr-1"},{default:a(()=>[t(T(P))]),_:1}),e[20]||(e[20]=r(" 搜索 ",-1))]),_:1}),t(p,{onClick:Z},{default:a(()=>[t(S,{class:"mr-1"},{default:a(()=>[t(T(xe))]),_:1}),e[21]||(e[21]=r(" 重置 ",-1))]),_:1})])])]),o("div",Ue,[ye((x(),$(re,{data:N.value,onSelectionChange:le,"row-key":"id"},{default:a(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"version",label:"版本号",width:"120"},{default:a(({row:l})=>[t(h,{type:"primary",size:"small"},{default:a(()=>[r(d(l.version),1)]),_:2},1024)]),_:1}),t(c,{prop:"title",label:"更新标题","min-width":"200"},{default:a(({row:l})=>[o("span",Se,d(l.title),1)]),_:1}),t(c,{prop:"type",label:"类型",width:"120"},{default:a(({row:l})=>[t(h,{type:E(l.type),size:"small"},{default:a(()=>[r(d(K(l.type)),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"content",label:"更新内容","min-width":"300"},{default:a(({row:l})=>[o("div",Me,[o("p",Te,d(l.content),1)])]),_:1}),t(c,{prop:"releaseDate",label:"发布日期",width:"120"},{default:a(({row:l})=>[r(d(C(l.releaseDate)),1)]),_:1}),t(c,{prop:"isImportant",label:"重要更新",width:"100"},{default:a(({row:l})=>[l.isImportant?(x(),$(h,{key:0,type:"danger",size:"small"},{default:a(()=>[...e[22]||(e[22]=[r("重要",-1)])]),_:1})):(x(),M("span",Be,"-"))]),_:1}),t(c,{prop:"createTime",label:"创建时间",width:"180"},{default:a(({row:l})=>[r(d(C(l.createTime)),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[o("div",je,[t(p,{onClick:L=>se(l),size:"small",type:"primary",plain:""},{default:a(()=>[...e[23]||(e[23]=[r(" 查看 ",-1)])]),_:1},8,["onClick"]),t(p,{onClick:L=>R(l),size:"small"},{default:a(()=>[...e[24]||(e[24]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(p,{onClick:L=>A(l),size:"small",type:"danger",plain:""},{default:a(()=>[...e[25]||(e[25]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[me,B.value]]),o("div",Ie,[o("div",Ye," 共 "+d(I.value)+" 条记录 ",1),t(ie,{"current-page":m.page,"onUpdate:currentPage":e[2]||(e[2]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>m.pageSize=l),"page-sizes":[10,20,50,100],total:I.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),t(J,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=l=>k.value=l),title:W.value,width:"600px","close-on-click-modal":!1,onClose:G},{footer:a(()=>[o("div",$e,[t(p,{onClick:G},{default:a(()=>[...e[27]||(e[27]=[r("取消",-1)])]),_:1}),t(p,{onClick:ne,type:"primary",loading:j.value},{default:a(()=>[r(d(n.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(pe,{ref_key:"formRef",ref:V,model:i,rules:X,"label-width":"100px",onSubmit:e[11]||(e[11]=be(()=>{},["prevent"]))},{default:a(()=>[t(_,{label:"版本号",prop:"version"},{default:a(()=>[t(z,{modelValue:i.version,"onUpdate:modelValue":e[4]||(e[4]=l=>i.version=l),placeholder:"例如: v1.0.0",maxlength:"20"},null,8,["modelValue"])]),_:1}),t(_,{label:"更新标题",prop:"title"},{default:a(()=>[t(z,{modelValue:i.title,"onUpdate:modelValue":e[5]||(e[5]=l=>i.title=l),placeholder:"请输入更新标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(_,{label:"更新类型",prop:"type"},{default:a(()=>[t(H,{modelValue:i.type,"onUpdate:modelValue":e[6]||(e[6]=l=>i.type=l),placeholder:"选择更新类型",class:"w-full"},{default:a(()=>[t(g,{label:"功能更新",value:"feature"}),t(g,{label:"问题修复",value:"bugfix"}),t(g,{label:"性能优化",value:"optimization"}),t(g,{label:"安全更新",value:"security"}),t(g,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"更新内容",prop:"content"},{default:a(()=>[t(z,{modelValue:i.content,"onUpdate:modelValue":e[7]||(e[7]=l=>i.content=l),type:"textarea",rows:6,placeholder:"详细描述本次更新的内容...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(_,{label:"发布日期",prop:"releaseDate"},{default:a(()=>[t(de,{modelValue:i.releaseDate,"onUpdate:modelValue":e[8]||(e[8]=l=>i.releaseDate=l),type:"date",placeholder:"选择发布日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"w-full"},null,8,["modelValue"])]),_:1}),t(_,{label:"重要更新"},{default:a(()=>[t(ue,{modelValue:i.isImportant,"onUpdate:modelValue":e[9]||(e[9]=l=>i.isImportant=l)},null,8,["modelValue"]),e[26]||(e[26]=o("span",{class:"ml-2 text-sm text-gray-500"},"标记为重要更新",-1))]),_:1}),t(_,{label:"更新链接"},{default:a(()=>[t(z,{modelValue:i.link,"onUpdate:modelValue":e[10]||(e[10]=l=>i.link=l),placeholder:"相关链接（可选）",maxlength:"200"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(J,{modelValue:w.value,"onUpdate:modelValue":e[16]||(e[16]=l=>w.value=l),title:"更新记录详情",width:"600px","close-on-click-modal":!1},{footer:a(()=>[o("div",We,[t(p,{onClick:e[13]||(e[13]=l=>w.value=!1)},{default:a(()=>[...e[34]||(e[34]=[r("关闭",-1)])]),_:1}),t(p,{onClick:e[14]||(e[14]=l=>R(n.value))},{default:a(()=>[...e[35]||(e[35]=[r("编辑",-1)])]),_:1}),t(p,{onClick:e[15]||(e[15]=l=>A(n.value)),type:"danger"},{default:a(()=>[...e[36]||(e[36]=[r("删除",-1)])]),_:1})])]),default:a(()=>[n.value?(x(),M("div",qe,[o("div",Ne,[o("div",Ee,[t(h,{type:"primary",size:"large"},{default:a(()=>[r(d(n.value.version),1)]),_:1}),o("div",null,[o("h3",Ke,d(n.value.title),1),o("p",Oe,d(C(n.value.releaseDate)),1)])]),o("div",Re,[t(h,{type:E(n.value.type),size:"small"},{default:a(()=>[r(d(K(n.value.type)),1)]),_:1},8,["type"]),n.value.isImportant?(x(),$(h,{key:0,type:"danger",size:"small"},{default:a(()=>[...e[28]||(e[28]=[r("重要",-1)])]),_:1})):q("",!0)])]),o("div",Ae,[e[29]||(e[29]=o("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"更新内容",-1)),o("p",Fe,d(n.value.content),1)]),n.value.link?(x(),M("div",Ge,[e[30]||(e[30]=o("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"相关链接",-1)),o("a",{href:n.value.link,target:"_blank",class:"text-blue-600 dark:text-blue-400 hover:underline"},d(n.value.link),9,He)])):q("",!0),o("div",Je,[e[33]||(e[33]=o("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"其他信息",-1)),o("div",Le,[o("div",null,[e[31]||(e[31]=o("span",{class:"text-gray-500 dark:text-gray-400"},"创建时间:",-1)),o("span",Pe,d(C(n.value.createTime)),1)]),o("div",null,[e[32]||(e[32]=o("span",{class:"text-gray-500 dark:text-gray-400"},"更新时间:",-1)),o("span",Qe,d(C(n.value.updateTime)),1)])])])])):q("",!0)]),_:1},8,["modelValue"])])}}},at=ke(Xe,[["__scopeId","data-v-bfd71279"]]);export{at as default};
