# 个人中心接口文档

## 基础信息

- **基础URL**: `http://your-domain.com/`
- **认证方式**: Bearer Token (JWT) - 所有接口都需要认证
- **请求头**: `Authorization: Bearer <token>`
- **响应格式**: JSON
- **内容类型**: `application/json`

## 通用响应格式

### 成功响应
```json
{
  "code": 200,
  "msg": "success",
  "data": {}
}
```

### 错误响应
```json
{
  "code": 400,
  "msg": "错误信息",
  "data": null
}
```

---

## 1. 获取用户信息

### 1.1 获取当前用户信息（已存在，需要补充字段）
- **URL**: `GET /user/user/userinfo`
- **描述**: 获取当前登录用户的详细信息
- **认证**: 需要
- **请求参数**: 无
- **响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "id": 1,
    "username": "hazenix",
    "email": "hazenix@example.com",
    "avatar": "头像URL",
    "gender": 1,

  }
}
```

**字段说明**:
- `id` (int): 用户ID
- `username` (string): 用户名
- `email` (string): 邮箱
- `nickname` (string, 可选): 昵称，未设置时为null或空字符串
- `gender` (int): 性别，0保密/未知 1男 2女




---

## 2. 获取用户统计信息

### 2.1 获取用户统计信息
- **URL**: `GET /user/user/stats`
- **描述**: 获取当前登录用户的统计数据（文章数、点赞数、评论数）
- **认证**: 需要
- **请求参数**: 无
- **响应示例**:
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "favoriteCount": 10,
    "likeCount": 1520,
    "commentsCount": 25
  }
}
```

**字段说明**:
- `articlesCount` (int): 用户发布的文章总数（只统计状态为正常的文章）
- `commentsCount` (int): 用户发表的评论总数（只统计状态为正常的评论）
- `totalViews` (int): 用户所有文章的总浏览量

**业务逻辑说明**:
- `articlesCount`: 统计该用户创建的所有状态为正常（status=0）的文章数量
- `commentsCount`: 统计该用户创建的所有状态为正常（status=0）的评论数量
- `totalViews`: 统计该用户所有状态为正常的文章的总浏览量（viewCount字段之和）

**错误响应示例**:
```json
{
  "code": 401,
  "msg": "未登录或token已过期",
  "data": null
}
```

---

## 3. 更新用户资料

### 3.1 更新用户基本信息
- **URL**: `PUT /user/user/profile`
- **描述**: 更新当前登录用户的基本信息（昵称、邮箱、个人简介）
- **认证**: 需要
- **请求体**:
```json
{
  "username": "新昵称",
  "email": "newemail@example.com",
  "gender": 2,
  "avatar": "新头像地址"
}
```

**请求参数说明**:
- `username` (string, 可选): 昵称，最大长度建议48字符
- `email` (string, 可选): 邮箱，必须是有效的邮箱格式
- `gender` (int, 可选): 性别
- `avatar` (String, 可选): 头像地址


**响应示例**:
```json
{
  "code": 200,
  "msg": "更新成功",
  "data": {
    "id": 1,
    "username": "hazenix",
    "email": "newemail@example.com",
    "avatar": "头像URL",
    "gender": 1,

  }
}
```

**错误响应示例**:
```json
{
  "code": 400,
  "msg": "邮箱格式不正确",
  "data": null
}
```

```json
{
  "code": 400,
  "msg": "昵称长度不能超过48个字符",
  "data": null
}
```

```json
{
  "code": 400,
  "msg": "个人简介长度不能超过500个字符",
  "data": null
}
```

```json
{
  "code": 401,
  "msg": "未登录或token已过期",
  "data": null
}
```

**业务逻辑说明**:
- 所有字段都是可选的，只更新提交的字段
- 需要验证邮箱格式（如果提交了email字段）
- 需要验证邮箱是否已被其他用户使用（如果提交了email字段且与当前邮箱不同）
- 前端会在提交前进行基本的格式验证

---

## 4. 修改密码

### 4.1 修改用户密码
- **URL**: `PUT /user/user/password`
- **描述**: 修改当前登录用户的密码
- **认证**: 需要
- **请求体**:
```json
{
  "currentPassword": "当前密码",
  "newPassword": "新密码"
}
```

**请求参数说明**:
- `currentPassword` (string, 必填): 当前密码
- `newPassword` (string, 必填): 新密码，长度至少6位

**响应示例**:
```json
{
  "code": 200,
  "msg": null,
  "data": null
}
```
备注：前端自己提示用于“密码修改成功”

**错误响应示例**:
```json
{
  "code": 400,
  "msg": "当前密码不正确",
  "data": null
}
```

```json
{
  "code": 400,
  "msg": "新密码长度不能少于6位",
  "data": null
}
```

```json
{
  "code": 400,
  "msg": "新密码不能与当前密码相同",
  "data": null
}
```

```json
{
  "code": 401,
  "msg": "未登录或token已过期",
  "data": null
}
```

**业务逻辑说明**:
- 必须验证当前密码是否正确
- 新密码长度必须至少6位
- 新密码不能与当前密码相同
- 密码修改成功后，建议前端提示用户重新登录

---

## 5. 接口调用示例

### JavaScript/Axios 示例

```javascript
// 获取用户信息
const getUserInfo = async () => {
  try {
    const response = await axios.get('/user/userinfo', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    return response.data
  } catch (error) {
    console.error('获取用户信息失败:', error)
    throw error
  }
}

// 获取用户统计信息
const getUserStats = async () => {
  try {
    const response = await axios.get('/user/user/stats', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    return response.data
  } catch (error) {
    console.error('获取用户统计信息失败:', error)
    throw error
  }
}

// 更新用户资料
const updateUserProfile = async (profileData) => {
  try {
    const response = await axios.put('/user/user/profile', profileData, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
    return response.data
  } catch (error) {
    console.error('更新用户资料失败:', error)
    throw error
  }
}

// 修改密码
const updatePassword = async (passwordData) => {
  try {
    const response = await axios.put('/user/user/password', passwordData, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    })
    return response.data
  } catch (error) {
    console.error('修改密码失败:', error)
    throw error
  }
}

// 组合使用示例（更新资料和密码）
const updateProfileAndPassword = async (formData) => {
  try {
    const updateData = {
      nickname: formData.nickname,
      email: formData.email,
      bio: formData.bio
    }
    
    // 更新基本信息
    await updateUserProfile(updateData)
    
    // 如果修改了密码，单独调用密码修改接口
    if (formData.currentPassword && formData.newPassword) {
      await updatePassword({
        currentPassword: formData.currentPassword,
        newPassword: formData.newPassword
      })
    }
    
    return { success: true }
  } catch (error) {
    console.error('更新失败:', error)
    throw error
  }
}
```

---

## 6. 注意事项

1. **认证要求**: 所有接口都需要在请求头中携带有效的JWT token
2. **数据验证**: 后端需要进行严格的数据验证，包括格式验证、长度验证等
3. **邮箱唯一性**: 更新邮箱时，需要检查新邮箱是否已被其他用户使用
4. **密码安全**: 密码修改时需要验证当前密码的正确性
5. **统计数据**: 统计数据只统计状态为正常的数据，不包含草稿或已删除的数据
6. **字段可选性**: 更新接口中，所有字段都是可选的，只更新提交的字段
7. **时间格式**: 时间字段统一使用ISO 8601格式（如：`2024-01-01T00:00:00Z`）

---

## 7. 前端页面说明

### 7.1 个人中心页面 (`/profile`)
- 显示用户基本信息（用户名、邮箱、注册时间、昵称、个人简介、用户角色）
- 显示统计信息（我的文章数、我的评论数、总浏览量）
- 提供"编辑资料"按钮跳转到编辑页面

### 7.2 编辑资料页面 (`/profile/edit`)
- 可以修改昵称、邮箱、个人简介
- 可以修改密码（需要输入当前密码、新密码、确认新密码）
- 前端会进行基本的格式验证
- 提交时可以只更新基本信息，或者同时更新密码

---

## 8. 状态码说明

- `200`: 请求成功
- `400`: 请求参数错误（如格式不正确、长度超限等）
- `401`: 未登录或token已过期
- `403`: 权限不足
- `500`: 服务器内部错误

