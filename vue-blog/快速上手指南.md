# 快速上手指南：在树洞页面亮色模式添加视频背景

> 🎯 本指南帮助新程序员快速理解如何实施视频背景功能

---

## 📖 背景说明

**需求**：在树洞页面的**亮色模式**下显示日出视频背景  
**视频文件**：`src/assets/video/sunrise.mp4`  
**目标页面**：`src/views/TreeHole/index.vue`

---

## 🎬 视频教程（文字版）

### Step 1: 理解页面结构

首先看看当前的树洞页面是怎么组织的：

```vue
<template>
  <div class="container">
    <!-- 暗色模式背景 -->
    <div v-if="themeStore.isDark">
      <Galaxy ... />  <!-- 星空特效 -->
    </div>
    
    <!-- 输入区域 -->
    <div class="content_container">
      <!-- 树洞输入框 -->
    </div>
    
    <!-- 弹幕区域 -->
    <vue-danmaku>
      <!-- 弹幕列表 -->
    </vue-danmaku>
  </div>
</template>
```

**关键点**：
- `v-if="themeStore.isDark"` 控制暗色模式背景
- 我们需要添加一个类似的区块来控制亮色模式背景

---

### Step 2: 添加视频背景

在暗色模式背景后面，添加一个新的区块：

```vue
<!-- 暗色模式背景 -->
<div v-if="themeStore.isDark" class="background-wrapper">
  <Galaxy ... />
</div>

<!-- 亮色模式背景：添加这段代码 -->
<div v-if="!themeStore.isDark" class="background-wrapper">
  <video
    ref="videoRef"
    class="video-background"
    autoplay
    loop
    muted
    playsinline
  >
    <source src="@/assets/video/sunrise.mp4" type="video/mp4">
  </video>
</div>
```

**代码解释**：
- `v-if="!themeStore.isDark"` → 亮色模式时显示
- `ref="videoRef"` → Vue 引用，方便后续控制
- `autoplay` → 自动播放
- `loop` → 循环播放
- `muted` → 静音（浏览器要求）
- `playsinline` → 移动端内联播放

---

### Step 3: 添加 videoRef

在 `<script setup>` 部分添加引用：

```javascript
// 已有的代码
const userStore = useUserStore()
const themeStore = useThemeStore()

// 添加这行
const videoRef = ref(null)  // 视频引用
```

**位置**：在主题相关的变量声明附近

---

### Step 4: 添加样式

在 `<style scoped>` 部分添加视频样式：

```css
/* 在 .background-wrapper 样式后添加 */

.video-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;  /* 覆盖整个容器 */
  z-index: 0;
  pointer-events: none;  /* 不阻塞交互 */
}
```

**样式说明**：
- `position: absolute` → 绝对定位，覆盖全屏
- `object-fit: cover` → 保持宽高比，填充容器
- `pointer-events: none` → 视频不拦截鼠标事件

---

## 🧪 测试步骤

### 1. 启动项目

```bash
npm run dev
```

### 2. 访问树洞页面

打开浏览器，导航到 `/treehole`

### 3. 切换主题

点击主题切换按钮（从暗色切换到亮色）

### 4. 验证结果

应该看到：
- ✅ 亮色模式：日出视频背景
- ✅ 暗色模式：星空背景
- ✅ 输入框正常工作
- ✅ 弹幕正常滚动

---

## 🐛 常见问题

### Q1: 视频不播放？

**检查项**：
- [ ] 视频文件路径是否正确：`@/assets/video/sunrise.mp4`
- [ ] 是否添加了 `muted` 属性（必需）
- [ ] 浏览器是否支持 autoplay

**解决方案**：
```html
<!-- 确保有 muted 属性 -->
<video muted autoplay loop playsinline>
```

### Q2: 视频显示不完整？

**检查项**：
- [ ] 是否添加了 `object-fit: cover` 样式
- [ ] `.video-background` 是否有正确的宽高

**解决方案**：
```css
.video-background {
  width: 100%;
  height: 100%;
  object-fit: cover;  /* 关键 */
}
```

### Q3: 无法点击输入框？

**检查项**：
- [ ] 是否添加了 `pointer-events: none`

**解决方案**：
```css
.video-background {
  pointer-events: none;  /* 关键 */
}
```

---

## 📁 文件位置对照表

| 文件 | 位置 | 作用 |
|------|------|------|
| 主页面 | `src/views/TreeHole/index.vue` | 树洞页面主文件 |
| 视频文件 | `src/assets/video/sunrise.mp4` | 日出视频素材 |
| 主题管理 | `src/stores/theme.js` | 主题切换逻辑 |
| 星空背景 | `src/Backgrounds/Galaxy/Galaxy.vue` | 暗色模式背景 |

---

## 🔍 关键代码位置

### 1. 模板部分（Template）

**位置**：第 24-36 行

```vue
<!-- 视频背景（仅在亮色模式下显示） -->
<div v-if="!themeStore.isDark" class="background-wrapper">
  <video ref="videoRef" class="video-background" autoplay loop muted playsinline>
    <source src="@/assets/video/sunrise.mp4" type="video/mp4">
  </video>
</div>
```

### 2. 脚本部分（Script）

**位置**：第 124 行

```javascript
const videoRef = ref(null)  // 视频引用
```

### 3. 样式部分（Style）

**位置**：第 310-320 行

```css
.video-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  pointer-events: none;
}
```

---

## 🎨 进阶技巧

### 技巧 1: 添加加载指示器

```javascript
// 监听视频加载
const isLoading = ref(true)

onMounted(() => {
  if (videoRef.value) {
    videoRef.value.addEventListener('loadeddata', () => {
      isLoading.value = false
    })
  }
})
```

```vue
<!-- 显示加载中 -->
<div v-if="isLoading && !themeStore.isDark" class="loading">
  加载视频中...
</div>
```

### 技巧 2: 添加遮罩增强可读性

```css
.video-background {
  /* 原有样式 */
}

/* 添加遮罩 */
.video-background::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);
}
```

### 技巧 3: 主题切换过渡

```css
.background-wrapper {
  transition: opacity 0.5s ease;
}
```

---

## 📚 学习资源

### 官方文档

- [Vue 3 官方文档](https://vuejs.org/)
- [HTML5 video 元素](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)
- [CSS object-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)

### 项目相关文档

- `树洞亮色模式视频背景实施计划.md` - 详细计划
- `实施总结.md` - 实施总结
- `README.md` - 项目说明

---

## ✅ 检查清单

实施完成后，请确认：

- [ ] 代码已添加到正确位置
- [ ] 视频文件路径正确
- [ ] 样式已添加
- [ ] videoRef 已声明
- [ ] 测试通过（亮色/暗色切换）
- [ ] 无控制台错误

---

## 🎉 完成！

恭喜！你已经成功实施了视频背景功能。如果遇到任何问题，请参考上面的常见问题部分。

祝你编码愉快！🚀

