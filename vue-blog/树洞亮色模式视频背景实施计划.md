# 树洞页面亮色模式视频背景实施计划

## 一、项目概述

在树洞页面（`src/views/TreeHole/index.vue`）的**亮色模式**下添加日出视频背景，视频文件位于 `src/assets/video/sunrise.mp4`。

---

## 二、当前状态分析

### 2.1 树洞页面当前结构

**文件路径**：`src/views/TreeHole/index.vue`

当前页面已有以下特性：
- ✅ 暗色模式使用 `Galaxy` 组件作为动态星空背景
- ✅ 亮色模式仅使用纯色背景 `#f3f4f6`
- ✅ 已集成主题切换功能（`useThemeStore`）
- ✅ 输入区域和弹幕区域已经有过合理的 z-index 层级

**关键代码片段**（第1-88行）：

```vue
<template>
  <div :class="['container', { 'dark-mode': themeStore.isDark, 'light-mode': !themeStore.isDark }]">
    <!-- 动态背景（仅在暗色模式下显示） -->
    <div v-if="themeStore.isDark" class="background-wrapper">
      <Galaxy
        :focal="[0.5, 0.5]"
        :rotation="[1.0, 0.0]"
        :star-speed="0.3"
        :density="1.2"
        :hue-shift="240"
        :speed="0.8"
        :mouse-interaction="true"
        :glow-intensity="0.4"
        :saturation="0.2"
        :mouse-repulsion="true"
        :twinkle-intensity="0.3"
        :rotation-speed="0.05"
        :repulsion-strength="3"
        :auto-center-repulsion="0.5"
        :transparent="true"
      />
    </div>
    
    <!-- 输入区域 -->
    <div class="content_container" style="margin-top: 45px;">
      <!-- ... -->
    </div>

    <!-- 弹幕组件 -->
    <vue-danmaku 
      <!-- ... -->
    >
    </vue-danmaku>
  </div>
</template>
```

**当前样式**（第262-293行）：

```css
.container {
  position: fixed;
  top: 0;
  left: 0;
  min-width: 100vw;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  z-index: 0;
  transition: background-color 0.3s ease;
}

.container.dark-mode {
  background: #0a0e27;
}

.container.light-mode {
  background: #f3f4f6;  /* 需要替换为视频背景 */
}

.background-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}
```

### 2.2 主题状态管理

**文件路径**：`src/stores/theme.js`

```javascript
import { defineStore } from 'pinia'
import { ref, watch } from 'vue'

export const useThemeStore = defineStore('theme', () => {
    const isDark = ref(localStorage.getItem('theme') === 'dark')

    watch(isDark, (val) => {
        if (val) {
            document.documentElement.classList.add('dark')
            localStorage.setItem('theme', 'dark')
        } else {
            document.documentElement.classList.remove('dark')
            localStorage.setItem('theme', 'light')
        }
    }, { immediate: true })

    function toggleTheme() {
        isDark.value = !isDark.value
    }

    return { isDark, toggleTheme }
})
```

### 2.3 视频文件位置

**文件路径**：`src/assets/video/sunrise.mp4`

---

## 三、实施方案

### 3.1 设计目标

1. **亮色模式**：显示日出视频背景
2. **暗色模式**：保持原有 `Galaxy` 星空背景
3. **性能优化**：视频自动播放、循环、静音，cover 覆盖模式
4. **用户体验**：视频不干扰内容展示，输入框和弹幕可见性保证

### 3.2 修改方案

#### 方案A：直接在模板中添加 `<video>` 元素（推荐）

**优点**：
- 实现简单，代码量少
- 性能好，浏览器原生支持
- 易于维护

**缺点**：
- 没有复杂的交互效果

#### 方案B：创建独立的 VideoBackground 组件

**优点**：
- 代码解耦，可复用
- 便于扩展（如添加滤镜、过渡效果）

**缺点**：
- 增加文件数量
- 对于简单需求有点过度设计

**选择：方案A**（考虑到功能需求简单直接）

---

## 四、详细代码实施

### 4.1 修改 `src/views/TreeHole/index.vue`

#### Step 1: 修改模板部分

在 `<template>` 部分添加视频背景元素（约第22-23行之后）：

**修改前**：
```vue
<div v-if="themeStore.isDark" class="background-wrapper">
  <Galaxy ... />
</div>
```

**修改后**：
```vue
<!-- 动态背景（仅在暗色模式下显示） -->
<div v-if="themeStore.isDark" class="background-wrapper">
  <Galaxy ... />
</div>

<!-- 视频背景（仅在亮色模式下显示） -->
<div v-if="!themeStore.isDark" class="background-wrapper">
  <video
    ref="videoRef"
    class="video-background"
    autoplay
    loop
    muted
    playsinline
  >
    <source src="@/assets/video/sunrise.mp4" type="video/mp4">
  </video>
</div>
```

#### Step 2: 修改脚本部分

在 `<script setup>` 部分添加 video ref（约第104行之后）：

**修改前**：
```javascript
const userStore = useUserStore()
const themeStore = useThemeStore()
```

**修改后**：
```javascript
const userStore = useUserStore()
const themeStore = useThemeStore()
const videoRef = ref(null)  // 添加视频引用
```

#### Step 3: 修改样式部分

在 `<style scoped>` 部分添加视频样式（约第293行之后）：

**添加新样式**：
```css
/* 视频背景样式 */
.video-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;  /* 覆盖整个容器，保持宽高比 */
  z-index: 0;
  pointer-events: none;  /* 不影响鼠标事件 */
}

/* 可选：为视频添加轻微遮罩，确保内容可读性 */
.video-background::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);  /* 轻微白色遮罩 */
  pointer-events: none;
}
```

#### Step 4: 调整现有背景样式

修改 `.container.light-mode` 样式（约第281-283行）：

**修改前**：
```css
.container.light-mode {
  background: #f3f4f6; /* 浅灰色背景 */
}
```

**修改后**：
```css
.container.light-mode {
  background: #f3f4f6; /* 浅灰色背景（作为fallback） */
}
```

---

## 五、完整代码示例

### 5.1 修改后的 template 部分（关键片段）

```vue
<template>
  <div :class="['container', { 'dark-mode': themeStore.isDark, 'light-mode': !themeStore.isDark }]">
    <!-- 动态背景（仅在暗色模式下显示） -->
    <div v-if="themeStore.isDark" class="background-wrapper">
      <Galaxy
        :focal="[0.5, 0.5]"
        :rotation="[1.0, 0.0]"
        :star-speed="0.3"
        :density="1.2"
        :hue-shift="240"
        :speed="0.8"
        :mouse-interaction="true"
        :glow-intensity="0.4"
        :saturation="0.2"
        :mouse-repulsion="true"
        :twinkle-intensity="0.3"
        :rotation-speed="0.05"
        :repulsion-strength="3"
        :auto-center-repulsion="0.5"
        :transparent="true"
      />
    </div>
    
    <!-- 视频背景（仅在亮色模式下显示） -->
    <div v-if="!themeStore.isDark" class="background-wrapper">
      <video
        ref="videoRef"
        class="video-background"
        autoplay
        loop
        muted
        playsinline
      >
        <source src="@/assets/video/sunrise.mp4" type="video/mp4">
      </video>
    </div>
    
    <!-- 输入区域 -->
    <div class="content_container" style="margin-top: 45px;">
      <!-- ... 保持不变 ... -->
    </div>

    <!-- 弹幕组件 -->
    <vue-danmaku 
      <!-- ... 保持不变 ... -->
    >
    </vue-danmaku>

    <!-- 加载遮罩 -->
    <div v-if="loading" class="loading_mask">
      <!-- ... 保持不变 ... -->
    </div>
  </div>
</template>
```

### 5.2 修改后的 script 部分（关键片段）

```javascript
<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { Loading } from '@element-plus/icons-vue'
import { getTreeHoleList, addTreeHole } from '@/api/treeHole.js'
import { getToken } from '@/utils/auth.js'
import { useUserStore } from '@/stores/user.js'
import { useThemeStore } from '@/stores/theme.js'
import Galaxy from '@/Backgrounds/Galaxy/Galaxy.vue'

// 响应式数据
const treeHoleList = ref([])
const isShowSubmit = ref(false)
const content = ref('')
const loading = ref(false)

// 获取用户信息和主题信息
const userStore = useUserStore()
const themeStore = useThemeStore()
const videoRef = ref(null)  // 新增：视频引用

// ... 其余代码保持不变 ...
</script>
```

### 5.3 新增的样式部分

```css
<style scoped>
/* ... 原有样式保持不变 ... */

/* 视频背景样式 */
.video-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;  /* 覆盖整个容器，保持宽高比 */
  z-index: 0;
  pointer-events: none;  /* 不影响鼠标事件 */
}

/* 可选：为视频添加轻微遮罩，确保内容可读性 */
.video-background::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.1);  /* 轻微白色遮罩 */
  pointer-events: none;
}

/* ... 原有样式保持不变 ... */
</style>
```

---

## 六、扩展优化（可选）

### 6.1 添加视频加载失败处理

如果需要处理视频加载失败的情况，可以添加错误处理：

```javascript
// 在 script setup 中添加
function handleVideoError() {
  console.error('视频加载失败')
  ElMessage.warning('背景视频加载失败，已切换到默认背景')
}
```

```vue
<!-- 在 video 元素上添加错误事件 -->
<video
  ref="videoRef"
  class="video-background"
  autoplay
  loop
  muted
  playsinline
  @error="handleVideoError"
>
  <source src="@/assets/video/sunrise.mp4" type="video/mp4">
</video>
```

### 6.2 添加视频过渡效果

如果需要切换主题时有平滑过渡，可以添加：

```css
.background-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  transition: opacity 0.5s ease;  /* 添加过渡效果 */
}
```

### 6.3 性能优化：降低视频质量

如果视频文件过大影响加载速度，可以考虑：
1. 使用更小的分辨率
2. 降低帧率
3. 使用更高效的编码格式（如 H.264）

---

## 七、测试检查清单

实施完成后，请按以下清单进行测试：

- [ ] **基础功能**
  - [ ] 亮色模式下视频背景正常显示
  - [ ] 暗色模式下星空背景正常显示
  - [ ] 视频自动播放、循环播放
  - [ ] 视频静音

- [ ] **响应式**
  - [ ] 不同屏幕尺寸下视频正确覆盖
  - [ ] 窗口大小改变时视频自适应

- [ ] **交互**
  - [ ] 输入框可正常点击和输入
  - [ ] 弹幕正常显示
  - [ ] 按钮可正常点击

- [ ] **性能**
  - [ ] 页面加载速度正常
  - [ ] 无明显卡顿

- [ ] **浏览器兼容性**
  - [ ] Chrome 浏览器测试通过
  - [ ] Edge 浏览器测试通过
  - [ ] Firefox 浏览器测试通过
  - [ ] Safari 浏览器测试通过（如适用）

---

## 八、文件清单

### 需要修改的文件

1. **src/views/TreeHole/index.vue**
   - 添加视频背景模板
   - 添加 videoRef 引用
   - 添加视频样式

### 相关文件（无需修改）

1. **src/stores/theme.js** - 主题状态管理
2. **src/assets/video/sunrise.mp4** - 视频素材
3. **src/Backgrounds/Galaxy/Galaxy.vue** - 暗色模式背景组件

---

## 九、参考资源

### 9.1 相关代码

- `src/views/Home.vue` - 参考其他页面的背景实现
- `src/views/TreeHole/index.vue` - 当前实现文件
- `背景参考代码.md` - 星空背景参考
- `背景参考代码2.md` - 其他背景效果参考

### 9.2 技术文档

- [MDN - HTML5 video](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)
- [CSS object-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)
- [Vue 3 响应式 API](https://vuejs.org/api/reactivity-core.html)

---

## 十、总结

本计划提供了一个简单、直接的方案，在树洞页面亮色模式下添加日出视频背景。核心思路是：

1. **复用现有结构**：利用已有的 `background-wrapper` 容器
2. **条件渲染**：使用 `v-if="!themeStore.isDark"` 在亮色模式显示
3. **原生实现**：使用 HTML5 `<video>` 元素，无需额外依赖
4. **性能优先**：autoplay、loop、muted、playsinline 确保自动播放
5. **样式优化**：`object-fit: cover` 确保视频覆盖，`pointer-events: none` 不阻塞交互

按照本计划实施，预计耗时 **10-15 分钟**，代码改动约 **30 行**。

