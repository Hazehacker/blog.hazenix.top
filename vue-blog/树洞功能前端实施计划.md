# æ ‘æ´åŠŸèƒ½å‰ç«¯å®æ–½è®¡åˆ’

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆè¯´æ˜](#æŠ€æœ¯æ ˆè¯´æ˜)
3. [å®æ–½æ­¥éª¤è¯¦è§£](#å®æ–½æ­¥éª¤è¯¦è§£)
4. [å®Œæ•´ä»£ç å®ç°](#å®Œæ•´ä»£ç å®ç°)
5. [è·¯ç”±é…ç½®](#è·¯ç”±é…ç½®)
6. [æ ·å¼è°ƒæ•´å»ºè®®](#æ ·å¼è°ƒæ•´å»ºè®®)
7. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æ ¹æ®æ‚¨æä¾›çš„æ¥å£æ–‡æ¡£ï¼Œæ ‘æ´åŠŸèƒ½éœ€è¦å®ç°ï¼š
- **è·å–æ ‘æ´åˆ—è¡¨**ï¼š`GET /user/tree/list`ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰
- **å‘é€å¼¹å¹•**ï¼š`POST /user/tree`ï¼ˆéœ€è¦è®¤è¯ï¼Œè¯·æ±‚ä½“ï¼š`{userId, username, content}`ï¼‰
- **ç®¡ç†ç«¯åŠŸèƒ½**ï¼ˆå¯é€‰ï¼‰ï¼šè·å–åˆ—è¡¨ã€åˆ é™¤ã€æ‰¹é‡åˆ é™¤

æ•°æ®åº“è¡¨ç»“æ„ï¼š
- `id`: bigint (ä¸»é”®)
- `user_id`: bigint (ç”¨æˆ·ID)
- `username`: varchar(32) (ç”¨æˆ·å)
- `content`: varchar(64) (å†…å®¹ï¼Œæ³¨æ„ï¼šé™åˆ¶64å­—ç¬¦)
- `status`: tinyint(1) (çŠ¶æ€ï¼š0æ­£å¸¸ï¼Œ1å·²åˆ é™¤)
- `create_time`: datetime (åˆ›å»ºæ—¶é—´)

---

## ğŸ›  æŠ€æœ¯æ ˆè¯´æ˜

- **æ¡†æ¶**: Vue 3
- **è¯­è¨€**: JavaScriptï¼ˆæŒ‰æ‚¨çš„è¦æ±‚ï¼‰
- **UIåº“**: Element Plus
- **å¼¹å¹•åº“**: `vue3-danmaku` (ç‰ˆæœ¬: ^1.6.0)
- **HTTPè¯·æ±‚**: Axiosï¼ˆé€šè¿‡å°è£…çš„ http å·¥å…·ï¼‰
- **çŠ¶æ€ç®¡ç†**: Piniaï¼ˆç”¨äºè·å–ç”¨æˆ·ä¿¡æ¯ï¼‰

---

## ğŸ“¦ æ­¥éª¤ä¸€ï¼šå®‰è£…ä¾èµ–

å¦‚æœé¡¹ç›®ä¸­è¿˜æ²¡æœ‰å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼Œéœ€è¦å…ˆå®‰è£…ï¼š

```bash
npm install vue3-danmaku
# æˆ–
pnpm add vue3-danmaku
```

**æ³¨æ„**ï¼šæ ¹æ® target é¡¹ç›®çš„æƒ…å†µï¼Œ`element-plus` å’Œ `axios` åº”è¯¥å·²ç»å®‰è£…ã€‚

---

## ğŸ“ æ­¥éª¤äºŒï¼šåˆ›å»º API æ¥å£æ–‡ä»¶

### 2.1 æ–‡ä»¶ä½ç½®

æ ¹æ®æ‚¨çš„é¡¹ç›®ç»“æ„ï¼ŒAPI æ–‡ä»¶åº”è¯¥æ”¾åœ¨ `src/api/` ç›®å½•ä¸‹ã€‚

**æ–‡ä»¶è·¯å¾„**: `src/api/treeHole.js`

### 2.2 æ¥å£æ–‡æ¡£å¯¹æ¯”

| åŠŸèƒ½ | æ‚¨çš„æ¥å£ | è¯´æ˜ |
|------|---------|------|
| è·å–åˆ—è¡¨ | `GET /user/tree/list` | ä¸éœ€è¦è®¤è¯ |
| å‘é€å¼¹å¹• | `POST /user/tree` | éœ€è¦è®¤è¯ï¼Œè¯·æ±‚ä½“ï¼š`{userId, username, content}` |

### 2.3 API ä»£ç å®ç°

**å‚è€ƒç°æœ‰ä»£ç é£æ ¼**ï¼ˆå¦‚ `src/api/user.js` æˆ– `src/api/comment.js`ï¼‰ï¼š

```javascript
// src/api/treeHole.js
import http from '@/utils/request.js'  // æ ¹æ®æ‚¨çš„é¡¹ç›®è·¯å¾„è°ƒæ•´

/**
 * è·å–æ ‘æ´å¼¹å¹•åˆ—è¡¨
 * @returns {Promise} è¿”å›æ ‘æ´åˆ—è¡¨æ•°æ®
 */
export function getTreeHoleList() {
  return http({
    url: '/user/tree/list',
    method: 'get'
  })
}

/**
 * å‘é€å¼¹å¹•
 * @param {Object} data - å¼¹å¹•æ•°æ®
 * @param {number} data.userId - ç”¨æˆ·ID
 * @param {string} data.username - ç”¨æˆ·å
 * @param {string} data.content - å¼¹å¹•å†…å®¹ï¼ˆæœ€å¤š64å­—ç¬¦ï¼‰
 * @returns {Promise} è¿”å›æ“ä½œç»“æœ
 */
export function addTreeHole(data) {
  return http({
    url: '/user/tree',
    method: 'post',
    data: data
  })
}
```

**æ³¨æ„**ï¼š
- æ ¹æ®æ‚¨é¡¹ç›®ä¸­ `http` çš„å°è£…æ–¹å¼ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´è¯·æ±‚æ ¼å¼
- å¦‚æœæ‚¨çš„ `request.js` å·²ç»è‡ªåŠ¨æ·»åŠ äº†è®¤è¯ tokenï¼Œ`addTreeHole` ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†
- å¦‚æœæ¥å£éœ€è¦ `Content-Type: application/json`ï¼Œç¡®ä¿ `request.js` å·²é…ç½®

---

## ğŸ¨ æ­¥éª¤ä¸‰ï¼šåˆ›å»ºæ ‘æ´é¡µé¢ç»„ä»¶

### 3.1 æ–‡ä»¶ä½ç½®

**æ–‡ä»¶è·¯å¾„**: `src/views/TreeHole/index.vue` æˆ– `src/views/Amusement/TreeHole/index.vue`

æ ¹æ®æ‚¨çš„é¡¹ç›®ç»“æ„é€‰æ‹©åˆé€‚çš„è·¯å¾„ã€‚

### 3.2 å®Œæ•´ç»„ä»¶ä»£ç ï¼ˆJavaScript ç‰ˆæœ¬ï¼‰

```vue
<script setup>
import { ref, onMounted, computed } from 'vue'
import vueDanmaku from 'vue3-danmaku'
import { ElMessage } from 'element-plus'
import { getTreeHoleList, addTreeHole } from '@/api/treeHole.js'
import { useUserStore } from '@/stores/user.js'  // æ ¹æ®æ‚¨çš„ store è·¯å¾„å®ç°
import { GET_TOKEN } from '@/utils/auth.js'  // æ ¹æ®æ‚¨çš„ auth å·¥å…·è·¯å¾„

// å“åº”å¼æ•°æ®
const treeHoleList = ref([])        // æ ‘æ´åˆ—è¡¨æ•°æ®
const isShowSubmit = ref(false)     // æ§åˆ¶æäº¤æŒ‰é’®æ˜¾ç¤º
const content = ref('')             // è¾“å…¥æ¡†å†…å®¹
const loading = ref(false)          // åŠ è½½çŠ¶æ€

// è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
const userStore = useUserStore()

// ç»„ä»¶æŒ‚è½½æ—¶è·å–æ•°æ®
onMounted(() => {
  getTreeHole()
})

/**
 * è·å–æ ‘æ´åˆ—è¡¨
 */
async function getTreeHole() {
  try {
    loading.value = true
    const res = await getTreeHoleList()
    if (res.code === 200) {
      // å¤„ç†æ•°æ®æ ¼å¼ï¼šç¡®ä¿è¿”å›çš„æ•°æ®åŒ…å«å¼¹å¹•æ‰€éœ€å­—æ®µ
      treeHoleList.value = res.data.map(item => ({
        id: item.id,
        nickname: item.username || 'åŒ¿åç”¨æˆ·',  // å¦‚æœ username ä¸ºç©ºï¼Œæ˜¾ç¤ºåŒ¿å
        avatar: item.avatar || '/default-avatar.png',  // é»˜è®¤å¤´åƒï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
        content: item.content,
        createTime: item.create_time
      }))
    } else {
      ElMessage.error(res.msg || 'è·å–æ•°æ®å¤±è´¥')
    }
  } catch (error) {
    console.error('è·å–æ ‘æ´åˆ—è¡¨å¤±è´¥:', error)
    ElMessage.error('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  } finally {
    loading.value = false
  }
}

/**
 * æäº¤æ ‘æ´å†…å®¹
 */
async function addTreeHoleBtn() {
  // éªŒè¯è¾“å…¥
  if (!content.value || content.value.trim() === '') {
    ElMessage.warning('è¯·è¾“å…¥å†…å®¹')
    return
  }

  // éªŒè¯é•¿åº¦ï¼ˆæ•°æ®åº“é™åˆ¶64å­—ç¬¦ï¼‰
  if (content.value.length > 64) {
    ElMessage.warning('å†…å®¹ä¸èƒ½è¶…è¿‡64ä¸ªå­—ç¬¦')
    return
  }

  // æ£€æŸ¥æ˜¯å¦ç™»å½•
  const token = GET_TOKEN()
  if (!token) {
    ElMessage.warning('è¯·å…ˆç™»å½•åå†å‘è¡¨å¼¹å¹•')
    // å¯ä»¥è·³è½¬åˆ°ç™»å½•é¡µ
    // router.push('/login')
    return
  }

  // è·å–ç”¨æˆ·ä¿¡æ¯
  let userId = null
  let username = ''

  // æ–¹å¼1ï¼šä» userStore è·å–
  if (userStore.userInfo) {
    userId = userStore.userInfo.id || userStore.userInfo.userId
    username = userStore.userInfo.username || userStore.userInfo.nickname || ''
  }

  // æ–¹å¼2ï¼šå¦‚æœ userStore æ²¡æœ‰ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£
  // è¿™é‡Œéœ€è¦æ ¹æ®æ‚¨çš„å®é™…é¡¹ç›®å®ç°è°ƒæ•´

  if (!userId) {
    ElMessage.error('æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•')
    return
  }

  try {
    const res = await addTreeHole({
      userId: userId,
      username: username,
      content: content.value.trim()
    })

    if (res.code === 200) {
      ElMessage.success(res.msg || 'å‘è¡¨æˆåŠŸ')
      content.value = ''           // æ¸…ç©ºè¾“å…¥
      isShowSubmit.value = false   // éšè—æäº¤æŒ‰é’®
      await getTreeHole()          // åˆ·æ–°åˆ—è¡¨
    } else {
      ElMessage.error(res.msg || 'å‘è¡¨å¤±è´¥')
    }
  } catch (error) {
    console.error('å‘è¡¨å¼¹å¹•å¤±è´¥:', error)
    ElMessage.error('å‘è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  }
}
</script>

<template>
  <div class="container">
    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="content_container">
      <div class="title">æ ‘æ´</div>
      <div class="input_wrapper">
        <input 
          v-model="content" 
          @focus="isShowSubmit = true" 
          @blur="handleInputBlur"
          type="text" 
          placeholder="åœ¨è¿™é‡Œç•™ä¸‹è‡ªå·±çš„è¶³è¿¹å§..."
          maxlength="64"
          :disabled="loading"
        >
        <button 
          v-show="isShowSubmit" 
          @click="addTreeHoleBtn"
          :disabled="loading"
        >
          <span class="submit-text">æäº¤</span>
        </button>
      </div>
      <!-- å­—ç¬¦è®¡æ•°æç¤º -->
      <div class="char-count" v-if="content.length > 0">
        {{ content.length }}/64
      </div>
    </div>

    <!-- å¼¹å¹•ç»„ä»¶ -->
    <vue-danmaku 
      :debounce="3000"              <!-- é˜²æŠ–æ—¶é—´3ç§’ -->
      random-channel                <!-- éšæœºé€šé“ -->
      :speeds="80"                  <!-- æ»šåŠ¨é€Ÿåº¦ -->
      :channels="5"                 <!-- å¼¹å¹•è½¨é“æ•° -->
      is-suspend                    <!-- é¼ æ ‡æ‚¬åœæš‚åœ -->
      v-model:danmus="treeHoleList"    <!-- å¼¹å¹•æ•°æ®ç»‘å®š -->
      use-slot                      <!-- ä½¿ç”¨æ’æ§½è‡ªå®šä¹‰æ ·å¼ -->
      loop                          <!-- å¾ªç¯æ’­æ”¾ -->
      style="height:100vh; width:100vw;"
    >
      <!-- è‡ªå®šä¹‰å¼¹å¹•æ ·å¼ -->
      <template v-slot:dm="{ danmu }">
        <div class="barrage_container">
          <div class="avatar_wrapper">
            <el-avatar :src="danmu.avatar" :size="40">
              <template #default>
                {{ danmu.nickname ? danmu.nickname.charAt(0) : 'åŒ¿' }}
              </template>
            </el-avatar>
          </div>
          <div class="content_wrapper">
            <span class="nickname">{{ danmu.nickname }}ï¼š</span>
            <span class="content">{{ danmu.content }}</span>
          </div>
        </div>
      </template>
    </vue-danmaku>

    <!-- åŠ è½½é®ç½© -->
    <div v-if="loading" class="loading_mask">
      <el-icon class="is-loading"><Loading /></el-icon>
    </div>
  </div>
</template>

<style scoped lang="scss">
.container {
  position: relative;
  background-image: url('ä½ çš„èƒŒæ™¯å›¾ç‰‡URL');  // æ›¿æ¢ä¸ºå®é™…èƒŒæ™¯å›¾
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  min-width: 100vw;
  height: 100vh;
  overflow: hidden;

  // è¾“å…¥åŒºåŸŸæ ·å¼
  .content_container {
    position: absolute;
    top: 40%;
    left: 50%;
    z-index: 2;                    // ç¡®ä¿åœ¨å¼¹å¹•ä¸Šæ–¹
    transform: translate(-50%, -50%);
    text-align: center;

    .title {
      color: white;
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 0 10px #000;  // æ–‡å­—é˜´å½±ï¼Œæé«˜å¯è¯»æ€§
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.2rem;
      margin-bottom: 1rem;
    }

    .input_wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;

      input {
        width: 16rem;
        height: 2rem;
        border: #409EFF solid 1px;
        border-radius: 1rem;
        outline: none;
        padding: 0 1rem;
        font-size: 1rem;
        background-color: rgba(255, 255, 255, 0.2);  // åŠé€æ˜èƒŒæ™¯
        color: white;
        transition: all 0.3s ease;

        &:focus {
          background-color: rgba(255, 255, 255, 0.3);
          border-color: #66b1ff;
        }

        &::placeholder {
          color: rgba(255, 255, 255, 0.7);
          font-style: italic;
        }

        &:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
      }

      button {
        width: 5rem;
        height: 2rem;
        border-radius: 1rem;
        outline: none;
        background-color: rgba(255, 255, 255, 0.2);
        border: #409EFF solid 1px;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;

        &:hover:not(:disabled) {
          background-color: rgba(255, 255, 255, 0.5);
          border-color: #66b1ff;
        }

        &:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .submit-text {
          color: white;
          font-style: italic;
          font-weight: bold;
        }
      }
    }

    .char-count {
      margin-top: 0.5rem;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.875rem;
    }
  }

  // å¼¹å¹•é¡¹æ ·å¼
  .barrage_container {
    display: flex;
    align-items: center;
    position: relative;
    padding: 0.5rem;
    border-radius: 0.5rem;
    background-color: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;

    // æ‚¬åœæ—¶çš„ä¸‹åˆ’çº¿åŠ¨ç”»
    &::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 0.2em;
      border-radius: 0.1em;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      transition: width 0.3s ease;
    }

    &:hover {
      background-color: rgba(255, 255, 255, 0.25);

      &::after {
        width: 100%;  // æ‚¬åœæ—¶ä¸‹åˆ’çº¿å±•å¼€
      }
    }

    .avatar_wrapper {
      flex-shrink: 0;
    }

    .content_wrapper {
      margin-left: 0.5rem;
      display: flex;
      align-items: center;
      flex-wrap: wrap;

      .nickname {
        color: white;
        font-weight: bold;
        margin-right: 0.25rem;
      }

      .content {
        color: white;
        font-size: 1rem;
      }
    }
  }

  // åŠ è½½é®ç½©
  .loading_mask {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;

    .el-icon {
      font-size: 2rem;
      color: white;
    }
  }
}
</style>
```

### 3.3 è¾…åŠ©å‡½æ•°ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦å¤„ç†è¾“å…¥æ¡†å¤±ç„¦é€»è¾‘ï¼š

```javascript
// åœ¨ script setup ä¸­æ·»åŠ 
function handleInputBlur() {
  // å»¶è¿Ÿéšè—ï¼Œé¿å…ç‚¹å‡»æäº¤æŒ‰é’®æ—¶æŒ‰é’®æ¶ˆå¤±
  setTimeout(() => {
    if (content.value === '') {
      isShowSubmit.value = false
    }
  }, 200)
}
```

---

## ğŸ—º æ­¥éª¤å››ï¼šé…ç½®è·¯ç”±

### 4.1 è·¯ç”±æ–‡ä»¶ä½ç½®

æ ¹æ®æ‚¨çš„é¡¹ç›®ç»“æ„ï¼Œè·¯ç”±é…ç½®åº”è¯¥åœ¨ `src/router/index.js`ã€‚

### 4.2 æ·»åŠ è·¯ç”±é…ç½®

åœ¨è·¯ç”±é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ ‘æ´è·¯ç”±ï¼š

```javascript
// src/router/index.js

// ... å…¶ä»–å¯¼å…¥

const routes = [
  {
    path: '/',
    component: Layout,  // æ ¹æ®æ‚¨çš„å¸ƒå±€ç»„ä»¶åç§°è°ƒæ•´
    children: [
      // ... å…¶ä»–è·¯ç”±
      
      // æ ‘æ´è·¯ç”±
      {
        path: '/tree-hole',
        name: 'treeHole',
        component: () => import('@/views/TreeHole/index.vue'),  // æ ¹æ®å®é™…è·¯å¾„è°ƒæ•´
        meta: {
          title: 'å¿ƒçµæ ‘æ´',
          requiresAuth: false  // æŸ¥çœ‹ä¸éœ€è¦ç™»å½•ï¼Œä½†å‘è¡¨éœ€è¦
        }
      },
      
      // ... å…¶ä»–è·¯ç”±
    ]
  },
  // ... å…¶ä»–è·¯ç”±é…ç½®
]
```

**æ³¨æ„**ï¼š
- å¦‚æœæ‚¨çš„è·¯ç”±æ–‡ä»¶ç»“æ„ä¸ç¤ºä¾‹ä¸åŒï¼Œè¯·æ ¹æ®å®é™…ç»“æ„è°ƒæ•´
- ç¡®ä¿å¯¼å…¥è·¯å¾„æ­£ç¡®

---

## ğŸ¯ æ­¥éª¤äº”ï¼šè·å–ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†

### 5.1 æ–¹å¼ä¸€ï¼šä½¿ç”¨ Pinia Store

å¦‚æœæ‚¨çš„é¡¹ç›®ä½¿ç”¨ Piniaï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–¹å¼ï¼š

```javascript
// åœ¨ç»„ä»¶ä¸­
import { useUserStore } from '@/stores/user.js'

const userStore = useUserStore()

// ç¡®ä¿ç”¨æˆ·ä¿¡æ¯å·²åŠ è½½
onMounted(async () => {
  if (!userStore.userInfo) {
    await userStore.getInfo()  // è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•
  }
  getTreeHole()
})

// åœ¨æäº¤æ—¶
const userId = userStore.userInfo?.id || userStore.userInfo?.userId
const username = userStore.userInfo?.username || userStore.userInfo?.nickname
```

### 5.2 æ–¹å¼äºŒï¼šç›´æ¥ä» Token æˆ– LocalStorage è·å–

å¦‚æœç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ localStorage ä¸­ï¼š

```javascript
function getUserInfo() {
  try {
    const userInfoStr = localStorage.getItem('userInfo') || sessionStorage.getItem('userInfo')
    if (userInfoStr) {
      return JSON.parse(userInfoStr)
    }
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
  }
  return null
}

// ä½¿ç”¨
const userInfo = getUserInfo()
const userId = userInfo?.id || userInfo?.userId
const username = userInfo?.username || userInfo?.nickname
```

### 5.3 æ–¹å¼ä¸‰ï¼šè°ƒç”¨ç”¨æˆ·ä¿¡æ¯æ¥å£

å¦‚æœéœ€è¦å®æ—¶è·å–ï¼š

```javascript
import { getUserInfo } from '@/api/user.js'  // æ ¹æ®æ‚¨çš„ API è·¯å¾„è°ƒæ•´

async function fetchUserInfo() {
  try {
    const res = await getUserInfo()
    if (res.code === 200) {
      return res.data
    }
  } catch (error) {
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
  }
  return null
}
```

---

## ğŸ”„ æ­¥éª¤å…­ï¼šæ•°æ®æ ¼å¼é€‚é…

### 6.1 åç«¯è¿”å›çš„æ•°æ®æ ¼å¼

æ ¹æ®æ¥å£æ–‡æ¡£ï¼Œåç«¯è¿”å›çš„æ•°æ®æ ¼å¼åº”è¯¥æ˜¯ï¼š

```json
{
  "code": 200,
  "msg": null,
  "data": [
    {
      "user_id": 2,
      "username": "ç”¨æˆ·å",
      "content": "å¼¹å¹•å†…å®¹",
      "create_time": "2024-01-01T00:00:00"
    }
  ]
}
```

### 6.2 æ•°æ®è½¬æ¢

åœ¨ `getTreeHole` å‡½æ•°ä¸­ï¼Œéœ€è¦å°†åç«¯æ•°æ®è½¬æ¢ä¸ºå¼¹å¹•ç»„ä»¶æ‰€éœ€æ ¼å¼ï¼š

```javascript
treeHoleList.value = res.data.map(item => {
  return {
    id: item.id,
    nickname: item.username || 'åŒ¿åç”¨æˆ·',
    avatar: item.avatar || getDefaultAvatar(),  // å¦‚æœæ²¡æœ‰å¤´åƒï¼Œä½¿ç”¨é»˜è®¤å¤´åƒ
    content: item.content,
    createTime: item.create_time
  }
})
```



---

## ğŸ“ æ­¥éª¤ä¸ƒï¼šæ ·å¼è°ƒæ•´

### 7.1 èƒŒæ™¯å›¾ç‰‡

æ›¿æ¢èƒŒæ™¯å›¾ç‰‡ URLï¼š

```scss
.container {
  background-image: url('@/assets/images/tree-hole-bg.jpg');  // ä½¿ç”¨é¡¹ç›®ä¸­çš„å›¾ç‰‡
  // æˆ–è€…
  // background-image: url('https://your-image-url.com/bg.jpg');  // ä½¿ç”¨åœ¨çº¿å›¾ç‰‡
}
```



---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 8.1 å­—ç¬¦é•¿åº¦é™åˆ¶

- æ•°æ®åº“å­—æ®µ `content` é™åˆ¶ä¸º `varchar(64)`ï¼Œæ‰€ä»¥å†…å®¹æœ€å¤š 64 ä¸ªå­—ç¬¦
- å‰ç«¯éœ€è¦åšé•¿åº¦éªŒè¯å’Œæç¤º

### 8.2 è®¤è¯å¤„ç†

- è·å–åˆ—è¡¨ä¸éœ€è¦è®¤è¯
- å‘è¡¨å¼¹å¹•éœ€è¦è®¤è¯ï¼Œéœ€è¦å¤„ç†æœªç™»å½•æƒ…å†µ

### 8.3 é”™è¯¯å¤„ç†

- ç½‘ç»œé”™è¯¯å¤„ç†
- æ¥å£è¿”å›é”™è¯¯å¤„ç†
- ç”¨æˆ·æœªç™»å½•å¤„ç†

### 8.4 æ€§èƒ½ä¼˜åŒ–

- å¦‚æœå¼¹å¹•æ•°é‡å¾ˆå¤šï¼Œè€ƒè™‘åˆ†é¡µåŠ è½½
- ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹è¯·æ±‚
- å¼¹å¹•åº“å·²å†…ç½®é˜²æŠ–ï¼ˆ`debounce` å±æ€§ï¼‰

### 8.5 æ•°æ®å­—æ®µæ˜ å°„

æ ¹æ®æ¥å£æ–‡æ¡£ï¼Œåç«¯è¿”å›çš„å­—æ®µæ˜¯ï¼š
- `user_id` â†’ å‰ç«¯å¯èƒ½éœ€è¦æ˜ å°„åˆ° `userId`
- `username` â†’ å‰ç«¯ä½¿ç”¨ `nickname` æˆ– `username`
- `create_time` â†’ å‰ç«¯ä½¿ç”¨ `createTime`

### 8.6 åŒ¿åç”¨æˆ·å¤„ç†

å¦‚æœ `username` ä¸ºç©ºæˆ– `user_id` ä¸º nullï¼Œåº”è¯¥æ˜¾ç¤º"æ— åæ°"ã€‚

---

## ğŸ§ª æ­¥éª¤å…«ï¼šæµ‹è¯•è¦ç‚¹

1. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - âœ… é¡µé¢åŠ è½½æ—¶èƒ½è·å–å¹¶æ˜¾ç¤ºå¼¹å¹•åˆ—è¡¨
   - âœ… è¾“å…¥å†…å®¹åèƒ½æäº¤ï¼ˆéœ€è¦ç™»å½•ï¼‰
   - âœ… æœªç™»å½•æ—¶æç¤ºç™»å½•
   - âœ… å†…å®¹é•¿åº¦è¶…è¿‡ 64 å­—ç¬¦æ—¶æç¤º

2. **UIæµ‹è¯•**ï¼š
   - âœ… å¼¹å¹•æ­£å¸¸æ»šåŠ¨
   - âœ… é¼ æ ‡æ‚¬åœæ—¶å¼¹å¹•æš‚åœ
   - âœ… è¾“å…¥æ¡†èšç„¦æ—¶æ˜¾ç¤ºæäº¤æŒ‰é’®
   - âœ… æ ·å¼æ­£å¸¸æ˜¾ç¤º

3. **é”™è¯¯å¤„ç†æµ‹è¯•**ï¼š
   - âœ… ç½‘ç»œé”™è¯¯æ—¶çš„æç¤º
   - âœ… æ¥å£è¿”å›é”™è¯¯æ—¶çš„æç¤º
   - âœ… ç”¨æˆ·æœªç™»å½•æ—¶çš„æç¤º

---



## âœ… å®æ–½ Checklist

- [ ] å®‰è£… `vue3-danmaku` ä¾èµ–
- [ ] åˆ›å»º `src/api/treeHole.js` æ–‡ä»¶
- [ ] åˆ›å»º `src/views/TreeHole/index.vue` ç»„ä»¶
- [ ] åœ¨è·¯ç”±ä¸­æ·»åŠ æ ‘æ´è·¯ç”±
- [ ] å¤„ç†ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘
- [ ] å¤„ç†æ•°æ®æ ¼å¼è½¬æ¢
- [ ] æ·»åŠ æ ·å¼å’ŒèƒŒæ™¯å›¾
- [ ] æµ‹è¯•åŸºæœ¬åŠŸèƒ½
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†
- [ ] ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### Q1: å¼¹å¹•ä¸æ˜¾ç¤ºï¼Ÿ

**æ£€æŸ¥**ï¼š
- `treeHoleList` æ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½
- æ•°æ®æ ¼å¼æ˜¯å¦ç¬¦åˆ `vue3-danmaku` è¦æ±‚
- ç»„ä»¶æ˜¯å¦æ­£ç¡®æŒ‚è½½

### Q2: æäº¤æ—¶æç¤ºæœªç™»å½•ï¼Ÿ

**æ£€æŸ¥**ï¼š
- Token æ˜¯å¦æ­£ç¡®è®¾ç½®
- `GET_TOKEN()` å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ
- è¯·æ±‚å¤´æ˜¯å¦åŒ…å«è®¤è¯ä¿¡æ¯

### Q3: ç”¨æˆ·ä¿¡æ¯è·å–å¤±è´¥ï¼Ÿ

**æ£€æŸ¥**ï¼š
- UserStore æ˜¯å¦æ­£ç¡®é…ç½®
- ç”¨æˆ·ä¿¡æ¯æ¥å£æ˜¯å¦æ­£å¸¸
- å­—æ®µåç§°æ˜¯å¦åŒ¹é…ï¼ˆ`id` vs `userId`ï¼‰

### Q4: æ ·å¼ä¸ç”Ÿæ•ˆï¼Ÿ

**æ£€æŸ¥**ï¼š
- SCSSæ”¹ä¸ºCSSï¼ˆå¦‚æœé¡¹ç›®ä¸ä½¿ç”¨SCSSï¼‰
- ç±»åæ˜¯å¦æ­£ç¡®
- æ˜¯å¦æœ‰æ ·å¼å†²çª

---

## ğŸ“ æ€»ç»“

æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤å®æ–½ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå®Œæˆæ ‘æ´åŠŸèƒ½çš„å‰ç«¯å¼€å‘ã€‚å…³é”®ç‚¹ï¼š

1. **æ¥å£é€‚é…**ï¼šæ ¹æ®æ‚¨çš„æ¥å£æ–‡æ¡£è°ƒæ•´ API è°ƒç”¨
2. **æ•°æ®è½¬æ¢**ï¼šå°†åç«¯æ•°æ®è½¬æ¢ä¸ºå¼¹å¹•ç»„ä»¶æ‰€éœ€æ ¼å¼
3. **ç”¨æˆ·è®¤è¯**ï¼šæ­£ç¡®å¤„ç†å£°éŸ³è®¤è¯å’Œç”¨æˆ·ä¿¡æ¯è·å–
4. **å­—ç¬¦é™åˆ¶**ï¼šæ³¨æ„ 64 å­—ç¬¦çš„é™åˆ¶
5. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æç¤ºå’Œå¼‚å¸¸å¤„ç†

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç°æœ‰ä»£ç çš„å®ç°æ–¹å¼ï¼Œä¿æŒä»£ç é£æ ¼ä¸€è‡´ã€‚

