# 网站统计接口说明

## 概述

本文档说明网站统计数据接口的需求和实现方案。

## 当前实现

目前前端通过调用 `/user/articles` 接口获取所有文章列表，然后在前端计算统计数据：
- 文章总数
- 文章总浏览量
- 文章总点赞数

### 优点
- 无需后端新增接口，使用现有接口即可实现
- 实现简单快速

### 缺点
- 需要传输所有文章的完整数据，数据量大
- 前端需要遍历计算，性能较差
- 如果文章数量很多，会影响页面加载速度

## 推荐方案：新增统计接口

为了优化性能和用户体验，建议后端提供一个专门的统计数据接口。

### 接口说明

#### 获取网站统计数据

- **URL**: `GET /user/articles/stats`
- **描述**: 获取网站文章统计数据（文章总数、总浏览量、总点赞数）
- **认证**: 不需要（公开接口）
- **请求参数**: 无

#### 响应示例

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "articleCount": 150,
    "totalViewCount": 15680,
    "totalLikeCount": 1234
  }
}
```

#### 响应字段说明

- `articleCount` (int): 已发布文章总数（不包括草稿和留言板文章）
- `totalViewCount` (int): 所有文章的总浏览量
- `totalLikeCount` (int): 所有文章的总点赞数

#### 注意事项

1. **统计范围**：只统计状态为正常（status=0）的已发布文章
2. **排除留言板**：需要排除 id=1 的留言板专用文章
3. **缓存建议**：建议后端对统计数据进行缓存（如 Redis），避免每次都查询数据库
4. **缓存更新**：当文章发布/删除、浏览量/点赞数变化时，更新缓存

### 接口实现建议

后端实现时，建议：

1. **使用数据库聚合查询**：使用 SQL 的 COUNT、SUM 函数直接计算，而不是获取所有文章再计算
2. **添加缓存**：使用 Redis 等缓存统计数据，设置合理的过期时间（如 5-10 分钟）
3. **缓存更新策略**：
   - 文章发布/删除时，更新文章总数缓存
   - 浏览量增加时，可以使用异步更新或批量更新策略
   - 点赞数变化时，更新总点赞数缓存

### 前端调用示例

```javascript
// 在 src/api/article.js 中添加
getSiteStats() {
  return request({
    url: '/user/articles/stats',
    method: 'get',
    isPublicResource: true // 标记为公开资源
  })
}

// 在组件中使用
import { articleApi } from '@/api/article'

const fetchSiteStats = async () => {
  try {
    const response = await articleApi.getSiteStats()
    if (response.code === 200 && response.data) {
      stats.value = {
        articleCount: response.data.articleCount || 0,
        totalViewCount: response.data.totalViewCount || 0,
        totalLikeCount: response.data.totalLikeCount || 0
      }
    }
  } catch (error) {
    console.error('获取网站统计数据失败:', error)
  }
}
```

## 总结

- **当前方案**：使用现有接口，前端计算统计（已实现）
- **推荐方案**：新增专门的统计接口，后端聚合计算（性能更优）

如果文章数量较少（< 100篇），当前方案可以满足需求。如果文章数量较多或需要更好的性能，建议实现推荐方案。

